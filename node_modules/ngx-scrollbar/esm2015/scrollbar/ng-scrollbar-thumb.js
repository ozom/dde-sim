/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Inject, Input, ViewChild, NgZone, ElementRef, ChangeDetectionStrategy, forwardRef } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { fromEvent, BehaviorSubject, Subscription, animationFrameScheduler } from 'rxjs';
import { debounceTime, throttleTime, mergeMap, pluck, takeUntil, tap } from 'rxjs/operators';
import { NgScrollbar } from './ng-scrollbar';
/**
 * @record
 */
function AxisProperties() { }
/** @type {?} */
AxisProperties.prototype.offsetYOrX;
/** @type {?} */
AxisProperties.prototype.scrollTopLeft;
/** @type {?} */
AxisProperties.prototype.clientYOrX;
/** @type {?} */
AxisProperties.prototype.topOrLeft;
/** @type {?} */
AxisProperties.prototype.clientHeightOrWidth;
/** @type {?} */
AxisProperties.prototype.scrollHeightOrWidth;
/** @type {?} */
AxisProperties.prototype.heightOrWidth;
/** @type {?} */
AxisProperties.prototype.transform;
/**
 * @record
 */
function Axis() { }
/** @type {?} */
Axis.prototype.vertical;
/** @type {?} */
Axis.prototype.horizontal;
const ɵ0 = (val) => `translate3d(0, ${val}px, 0)`, ɵ1 = (val) => `translate3d(${val}px, 0, 0)`;
/** @type {?} */
const axis = {
    vertical: {
        topOrLeft: 'top',
        offsetYOrX: 'offsetY',
        clientYOrX: 'clientY',
        heightOrWidth: 'height',
        scrollTopLeft: 'scrollTop',
        clientHeightOrWidth: 'clientHeight',
        scrollHeightOrWidth: 'scrollHeight',
        transform: ɵ0
    },
    horizontal: {
        topOrLeft: 'left',
        offsetYOrX: 'offsetX',
        clientYOrX: 'clientX',
        heightOrWidth: 'width',
        scrollTopLeft: 'scrollLeft',
        clientHeightOrWidth: 'clientWidth',
        scrollHeightOrWidth: 'scrollWidth',
        transform: ɵ1
    }
};
export class NgScrollbarThumb {
    /**
     * @param {?} zone
     * @param {?} document
     * @param {?} ngScrollbar
     */
    constructor(zone, document, ngScrollbar) {
        this.zone = zone;
        this.document = document;
        this.ngScrollbar = ngScrollbar;
        this._minThumbSize = 20;
        this._naturalThumbSize = 0;
        this._thumbSize = 0;
        this._trackMax = 0;
        this._scrollMax = 0;
        this._currPos = 0;
        this._scroll$ = Subscription.EMPTY;
        this._thumbDrag$ = Subscription.EMPTY;
        this._updateObserver$ = Subscription.EMPTY;
        this._state = new BehaviorSubject({
            transform: 'translate3d(0, 0, 0)'
        });
        /**
         * Scrollbar styles
         */
        this.scrollbarStyle = this._state.asObservable();
    }
    /**
     * Get the proper properties for scrollbar orientation
     * @return {?}
     */
    get axis() {
        return axis[this.orientation];
    }
    /**
     * Calculate scrollbar thumbnail size
     * @return {?}
     */
    get thumbSize() {
        /** @type {?} */
        const scrollBarClientHeightOrWidth = this.bar.nativeElement[this.axis.clientHeightOrWidth];
        /** @type {?} */
        const viewClientHeightOrWidth = this._view[this.axis.clientHeightOrWidth];
        /** @type {?} */
        const viewScrollHeightOrWidth = this._view[this.axis.scrollHeightOrWidth];
        this._naturalThumbSize = scrollBarClientHeightOrWidth / viewScrollHeightOrWidth * scrollBarClientHeightOrWidth;
        this._scrollMax = viewScrollHeightOrWidth - viewClientHeightOrWidth;
        return this.scrollBoundaries(this._naturalThumbSize, this._scrollMax);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this._view = this.ngScrollbar.scrollable.getElementRef().nativeElement;
        // Start view scroll event
        this._scroll$ = this.ngScrollbar.scrollable.elementScrolled()
            .subscribe(() => this.updateScrollbar());
        // Start scrollbar thumbnail drag events
        this.zone.runOutsideAngular(() => this._thumbDrag$ = this.startThumbEvents().subscribe());
        // Update scrollbar thumbnail size on content changes
        this._updateObserver$ = this.ngScrollbar.updateObserver.pipe(throttleTime(200), tap(() => this.updateScrollbar()), 
        // Make sure scrollbar thumbnail position is correct after the new content is rendered
        debounceTime(200), tap(() => this.updateScrollbar())).subscribe();
        // Initialize scrollbar
        setTimeout(() => this.updateScrollbar(), 200);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._scroll$.unsubscribe();
        this._thumbDrag$.unsubscribe();
        this._updateObserver$.unsubscribe();
    }
    /**
     * Scrollbar click
     * @param {?} e Mouse event
     * @return {?}
     */
    onScrollbarClick(e) {
        if (e.target === e.currentTarget) {
            /** @type {?} */
            const offsetYOrX = e[this.axis.offsetYOrX] - this._naturalThumbSize * .5;
            /** @type {?} */
            const thumbPositionPercentage = offsetYOrX * 100 / this.bar.nativeElement[this.axis.clientHeightOrWidth];
            /** @type {?} */
            const value = thumbPositionPercentage * this._view[this.axis.scrollHeightOrWidth] / 100;
            this.ngScrollbar.scrollTo(/** @type {?} */ ({ [this.axis.topOrLeft]: value, duration: this.scrollToDuration })).subscribe();
        }
    }
    /**
     * Update scrollbar
     * @return {?}
     */
    updateScrollbar() {
        this._thumbSize = this.thumb.nativeElement[this.axis.clientHeightOrWidth];
        this._trackMax = this.bar.nativeElement[this.axis.clientHeightOrWidth] - this._thumbSize;
        this._currPos = this._view[this.axis.scrollTopLeft] * this._trackMax / this._scrollMax;
        this.zone.run(() => animationFrameScheduler.schedule(() => this.updateState({
            transform: this.axis.transform(this._currPos),
            [this.axis.heightOrWidth]: `${this.thumbSize}px`
        })));
    }
    /**
     * Start vertical thumb worker
     * @return {?}
     */
    startThumbEvents() {
        /** @type {?} */
        const mouseDown$ = fromEvent(this.thumb.nativeElement, 'mousedown');
        /** @type {?} */
        const mouseMove$ = fromEvent(this.document, 'mousemove');
        /** @type {?} */
        const mouseUp$ = fromEvent(this.document, 'mouseup').pipe(tap(() => this.document.onselectstart = null));
        return mouseDown$.pipe(tap(() => {
            this.document.onselectstart = () => false;
            // Initialize trackMax for before start dragging
            this._trackMax = this.bar.nativeElement[this.axis.clientHeightOrWidth] - this._thumbSize;
        }), pluck(this.axis.offsetYOrX), mergeMap((mouseDownOffset) => mouseMove$.pipe(takeUntil(mouseUp$), pluck(this.axis.clientYOrX), tap((mouseMoveClient) => {
            /** @type {?} */
            const offsetYOrX = mouseMoveClient - this.bar.nativeElement.getBoundingClientRect()[this.axis.topOrLeft];
            /** @type {?} */
            const value = this._scrollMax * (offsetYOrX - mouseDownOffset) / this._trackMax;
            this.ngScrollbar.scrollable.scrollTo({ [this.axis.topOrLeft]: value });
        }))));
    }
    /**
     * Get scrollbar thumb size
     * @param {?} naturalThumbSize
     * @param {?} scrollMax
     * @return {?}
     */
    scrollBoundaries(naturalThumbSize, scrollMax) {
        return (naturalThumbSize < this._minThumbSize) ? this._minThumbSize : scrollMax ? naturalThumbSize : 0;
    }
    /**
     * @param {?} state
     * @return {?}
     */
    updateState(state) {
        this._state.next(Object.assign({}, this._state.value, state));
    }
}
NgScrollbarThumb.decorators = [
    { type: Component, args: [{
                selector: 'ng-scrollbar-thumb',
                changeDetection: ChangeDetectionStrategy.OnPush,
                template: `
    <div #bar class="ng-scrollbar ng-scrollbar-{{orientation}} {{barClass}}" (mousedown)="onScrollbarClick($event)">
      <div #thumb class="ng-scrollbar-thumb {{thumbClass}}" [ngStyle]="scrollbarStyle | async"></div>
    </div>
  `
            }] }
];
/** @nocollapse */
NgScrollbarThumb.ctorParameters = () => [
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: NgScrollbar, decorators: [{ type: Inject, args: [forwardRef(() => NgScrollbar),] }] }
];
NgScrollbarThumb.propDecorators = {
    barClass: [{ type: Input }],
    thumbClass: [{ type: Input }],
    scrollToDuration: [{ type: Input }],
    orientation: [{ type: Input }],
    bar: [{ type: ViewChild, args: ['bar',] }],
    thumb: [{ type: ViewChild, args: ['thumb',] }]
};
if (false) {
    /**
     * Scrollbar class
     * @type {?}
     */
    NgScrollbarThumb.prototype.barClass;
    /**
     * Scrollbar thumbnail class
     * @type {?}
     */
    NgScrollbarThumb.prototype.thumbClass;
    /**
     * The scroll duration when scrollbar (not the thumbnail) is clicked
     * @type {?}
     */
    NgScrollbarThumb.prototype.scrollToDuration;
    /**
     * Scrollbar orientation
     * @type {?}
     */
    NgScrollbarThumb.prototype.orientation;
    /** @type {?} */
    NgScrollbarThumb.prototype.bar;
    /** @type {?} */
    NgScrollbarThumb.prototype.thumb;
    /** @type {?} */
    NgScrollbarThumb.prototype._minThumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._naturalThumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._thumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._trackMax;
    /** @type {?} */
    NgScrollbarThumb.prototype._scrollMax;
    /** @type {?} */
    NgScrollbarThumb.prototype._currPos;
    /** @type {?} */
    NgScrollbarThumb.prototype._scroll$;
    /** @type {?} */
    NgScrollbarThumb.prototype._thumbDrag$;
    /** @type {?} */
    NgScrollbarThumb.prototype._updateObserver$;
    /** @type {?} */
    NgScrollbarThumb.prototype._view;
    /** @type {?} */
    NgScrollbarThumb.prototype._state;
    /**
     * Scrollbar styles
     * @type {?}
     */
    NgScrollbarThumb.prototype.scrollbarStyle;
    /** @type {?} */
    NgScrollbarThumb.prototype.zone;
    /** @type {?} */
    NgScrollbarThumb.prototype.document;
    /** @type {?} */
    NgScrollbarThumb.prototype.ngScrollbar;
}
export { ɵ0, ɵ1 };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLXRodW1iLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjcm9sbGJhci8iLCJzb3VyY2VzIjpbInNjcm9sbGJhci9uZy1zY3JvbGxiYXItdGh1bWIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUdOLEtBQUssRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUNOLFVBQVUsRUFDVix1QkFBdUIsRUFDdkIsVUFBVSxFQUNYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFjLGVBQWUsRUFBRSxZQUFZLEVBQW9CLHVCQUF1QixFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZILE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7V0EyQjlCLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsR0FBRyxRQUFRLE9BVTlDLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxlQUFlLEdBQUcsV0FBVzs7QUFuQjdELE1BQU0sSUFBSSxHQUFTO0lBQ2pCLFFBQVEsRUFBRTtRQUNSLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLFVBQVUsRUFBRSxTQUFTO1FBQ3JCLFVBQVUsRUFBRSxTQUFTO1FBQ3JCLGFBQWEsRUFBRSxRQUFRO1FBQ3ZCLGFBQWEsRUFBRSxXQUFXO1FBQzFCLG1CQUFtQixFQUFFLGNBQWM7UUFDbkMsbUJBQW1CLEVBQUUsY0FBYztRQUNuQyxTQUFTLElBQWdEO0tBQzFEO0lBQ0QsVUFBVSxFQUFFO1FBQ1YsU0FBUyxFQUFFLE1BQU07UUFDakIsVUFBVSxF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RSxvQkFBb0I7Z0JBQzlCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2dCQUMvQyxRQUFRLEVBQUU7Ozs7R0FJVDthQUNGOzs7O1lBekRDLE1BQU07NENBNkdPLE1BQU0sU0FBQyxRQUFRO1lBckdyQixXQUFXLHVCQXNHTCxNQUFNLFNBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQzs7O3VCQWpEaEQsS0FBSzt5QkFFTCxLQUFLOytCQUVMLEtBQUs7MEJBRUwsS0FBSztrQkFFTCxTQUFTLFNBQUMsS0FBSztvQkFDZixTQUFTLFNBQUMsT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5qZWN0LFxuICBBZnRlclZpZXdJbml0LFxuICBPbkRlc3Ryb3ksXG4gIElucHV0LFxuICBWaWV3Q2hpbGQsXG4gIE5nWm9uZSxcbiAgRWxlbWVudFJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIGZvcndhcmRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBTdWJzY3JpcHRpb25MaWtlLCBhbmltYXRpb25GcmFtZVNjaGVkdWxlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCB0aHJvdHRsZVRpbWUsIG1lcmdlTWFwLCBwbHVjaywgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBOZ1Njcm9sbGJhciB9IGZyb20gJy4vbmctc2Nyb2xsYmFyJztcblxuaW50ZXJmYWNlIEF4aXNQcm9wZXJ0aWVzIHtcbiAgb2Zmc2V0WU9yWDogc3RyaW5nO1xuICBzY3JvbGxUb3BMZWZ0OiBzdHJpbmc7XG4gIGNsaWVudFlPclg6IHN0cmluZztcbiAgdG9wT3JMZWZ0OiBzdHJpbmc7XG4gIGNsaWVudEhlaWdodE9yV2lkdGg6IHN0cmluZztcbiAgc2Nyb2xsSGVpZ2h0T3JXaWR0aDogc3RyaW5nO1xuICBoZWlnaHRPcldpZHRoOiBzdHJpbmc7XG4gIHRyYW5zZm9ybTogKHZhbDogbnVtYmVyKSA9PiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBBeGlzIHtcbiAgdmVydGljYWw6IEF4aXNQcm9wZXJ0aWVzO1xuICBob3Jpem9udGFsOiBBeGlzUHJvcGVydGllcztcbn1cblxuY29uc3QgYXhpczogQXhpcyA9IHtcbiAgdmVydGljYWw6IHtcbiAgICB0b3BPckxlZnQ6ICd0b3AnLFxuICAgIG9mZnNldFlPclg6ICdvZmZzZXRZJyxcbiAgICBjbGllbnRZT3JYOiAnY2xpZW50WScsXG4gICAgaGVpZ2h0T3JXaWR0aDogJ2hlaWdodCcsXG4gICAgc2Nyb2xsVG9wTGVmdDogJ3Njcm9sbFRvcCcsXG4gICAgY2xpZW50SGVpZ2h0T3JXaWR0aDogJ2NsaWVudEhlaWdodCcsXG4gICAgc2Nyb2xsSGVpZ2h0T3JXaWR0aDogJ3Njcm9sbEhlaWdodCcsXG4gICAgdHJhbnNmb3JtOiAodmFsOiBudW1iZXIpID0+IGB0cmFuc2xhdGUzZCgwLCAke3ZhbH1weCwgMClgXG4gIH0sXG4gIGhvcml6b250YWw6IHtcbiAgICB0b3BPckxlZnQ6ICdsZWZ0JyxcbiAgICBvZmZzZXRZT3JYOiAnb2Zmc2V0WCcsXG4gICAgY2xpZW50WU9yWDogJ2NsaWVudFgnLFxuICAgIGhlaWdodE9yV2lkdGg6ICd3aWR0aCcsXG4gICAgc2Nyb2xsVG9wTGVmdDogJ3Njcm9sbExlZnQnLFxuICAgIGNsaWVudEhlaWdodE9yV2lkdGg6ICdjbGllbnRXaWR0aCcsXG4gICAgc2Nyb2xsSGVpZ2h0T3JXaWR0aDogJ3Njcm9sbFdpZHRoJyxcbiAgICB0cmFuc2Zvcm06ICh2YWw6IG51bWJlcikgPT4gYHRyYW5zbGF0ZTNkKCR7dmFsfXB4LCAwLCAwKWBcbiAgfVxufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmctc2Nyb2xsYmFyLXRodW1iJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiAjYmFyIGNsYXNzPVwibmctc2Nyb2xsYmFyIG5nLXNjcm9sbGJhci17e29yaWVudGF0aW9ufX0ge3tiYXJDbGFzc319XCIgKG1vdXNlZG93bik9XCJvblNjcm9sbGJhckNsaWNrKCRldmVudClcIj5cbiAgICAgIDxkaXYgI3RodW1iIGNsYXNzPVwibmctc2Nyb2xsYmFyLXRodW1iIHt7dGh1bWJDbGFzc319XCIgW25nU3R5bGVdPVwic2Nyb2xsYmFyU3R5bGUgfCBhc3luY1wiPjwvZGl2PlxuICAgIDwvZGl2PlxuICBgXG59KVxuZXhwb3J0IGNsYXNzIE5nU2Nyb2xsYmFyVGh1bWIgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuXG4gIC8qKiBTY3JvbGxiYXIgY2xhc3MgKi9cbiAgQElucHV0KCkgYmFyQ2xhc3M6IHN0cmluZztcbiAgLyoqIFNjcm9sbGJhciB0aHVtYm5haWwgY2xhc3MgKi9cbiAgQElucHV0KCkgdGh1bWJDbGFzczogc3RyaW5nO1xuICAvKiogVGhlIHNjcm9sbCBkdXJhdGlvbiB3aGVuIHNjcm9sbGJhciAobm90IHRoZSB0aHVtYm5haWwpIGlzIGNsaWNrZWQgKi9cbiAgQElucHV0KCkgc2Nyb2xsVG9EdXJhdGlvbjogbnVtYmVyO1xuICAvKiogU2Nyb2xsYmFyIG9yaWVudGF0aW9uICovXG4gIEBJbnB1dCgpIG9yaWVudGF0aW9uOiAndmVydGljYWwnIHwgJ2hvcml6b250YWwnO1xuXG4gIEBWaWV3Q2hpbGQoJ2JhcicpIGJhcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgndGh1bWInKSB0aHVtYjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIF9taW5UaHVtYlNpemUgPSAyMDtcbiAgcHJpdmF0ZSBfbmF0dXJhbFRodW1iU2l6ZSA9IDA7XG4gIHByaXZhdGUgX3RodW1iU2l6ZSA9IDA7XG4gIHByaXZhdGUgX3RyYWNrTWF4ID0gMDtcbiAgcHJpdmF0ZSBfc2Nyb2xsTWF4ID0gMDtcbiAgcHJpdmF0ZSBfY3VyclBvcyA9IDA7XG4gIHByaXZhdGUgX3Njcm9sbCQ6IFN1YnNjcmlwdGlvbkxpa2UgPSBTdWJzY3JpcHRpb24uRU1QVFk7XG4gIHByaXZhdGUgX3RodW1iRHJhZyQ6IFN1YnNjcmlwdGlvbkxpa2UgPSBTdWJzY3JpcHRpb24uRU1QVFk7XG4gIHByaXZhdGUgX3VwZGF0ZU9ic2VydmVyJDogU3Vic2NyaXB0aW9uTGlrZSA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBfdmlldzogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgX3N0YXRlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHtcbiAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgwLCAwLCAwKSdcbiAgfSk7XG5cbiAgLyoqIFNjcm9sbGJhciBzdHlsZXMgKi9cbiAgc2Nyb2xsYmFyU3R5bGUgPSB0aGlzLl9zdGF0ZS5hc09ic2VydmFibGUoKTtcblxuICAvKipcbiAgICogR2V0IHRoZSBwcm9wZXIgcHJvcGVydGllcyBmb3Igc2Nyb2xsYmFyIG9yaWVudGF0aW9uXG4gICAqL1xuICBnZXQgYXhpcygpOiBBeGlzUHJvcGVydGllcyB7XG4gICAgcmV0dXJuIGF4aXNbdGhpcy5vcmllbnRhdGlvbl07XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHNjcm9sbGJhciB0aHVtYm5haWwgc2l6ZVxuICAgKi9cbiAgZ2V0IHRodW1iU2l6ZSgpOiBudW1iZXIge1xuICAgIGNvbnN0IHNjcm9sbEJhckNsaWVudEhlaWdodE9yV2lkdGggPSB0aGlzLmJhci5uYXRpdmVFbGVtZW50W3RoaXMuYXhpcy5jbGllbnRIZWlnaHRPcldpZHRoXTtcbiAgICBjb25zdCB2aWV3Q2xpZW50SGVpZ2h0T3JXaWR0aCA9IHRoaXMuX3ZpZXdbdGhpcy5heGlzLmNsaWVudEhlaWdodE9yV2lkdGhdO1xuICAgIGNvbnN0IHZpZXdTY3JvbGxIZWlnaHRPcldpZHRoID0gdGhpcy5fdmlld1t0aGlzLmF4aXMuc2Nyb2xsSGVpZ2h0T3JXaWR0aF07XG4gICAgdGhpcy5fbmF0dXJhbFRodW1iU2l6ZSA9IHNjcm9sbEJhckNsaWVudEhlaWdodE9yV2lkdGggLyB2aWV3U2Nyb2xsSGVpZ2h0T3JXaWR0aCAqIHNjcm9sbEJhckNsaWVudEhlaWdodE9yV2lkdGg7XG4gICAgdGhpcy5fc2Nyb2xsTWF4ID0gdmlld1Njcm9sbEhlaWdodE9yV2lkdGggLSB2aWV3Q2xpZW50SGVpZ2h0T3JXaWR0aDtcbiAgICByZXR1cm4gdGhpcy5zY3JvbGxCb3VuZGFyaWVzKHRoaXMuX25hdHVyYWxUaHVtYlNpemUsIHRoaXMuX3Njcm9sbE1heCk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHpvbmU6IE5nWm9uZSxcbiAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55LFxuICAgICAgICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gTmdTY3JvbGxiYXIpKSBwcml2YXRlIG5nU2Nyb2xsYmFyOiBOZ1Njcm9sbGJhcikge1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuX3ZpZXcgPSB0aGlzLm5nU2Nyb2xsYmFyLnNjcm9sbGFibGUuZ2V0RWxlbWVudFJlZigpLm5hdGl2ZUVsZW1lbnQ7XG4gICAgLy8gU3RhcnQgdmlldyBzY3JvbGwgZXZlbnRcbiAgICB0aGlzLl9zY3JvbGwkID0gdGhpcy5uZ1Njcm9sbGJhci5zY3JvbGxhYmxlLmVsZW1lbnRTY3JvbGxlZCgpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMudXBkYXRlU2Nyb2xsYmFyKCkpO1xuXG4gICAgLy8gU3RhcnQgc2Nyb2xsYmFyIHRodW1ibmFpbCBkcmFnIGV2ZW50c1xuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgdGhpcy5fdGh1bWJEcmFnJCA9IHRoaXMuc3RhcnRUaHVtYkV2ZW50cygpLnN1YnNjcmliZSgpXG4gICAgKTtcblxuICAgIC8vIFVwZGF0ZSBzY3JvbGxiYXIgdGh1bWJuYWlsIHNpemUgb24gY29udGVudCBjaGFuZ2VzXG4gICAgdGhpcy5fdXBkYXRlT2JzZXJ2ZXIkID0gdGhpcy5uZ1Njcm9sbGJhci51cGRhdGVPYnNlcnZlci5waXBlKFxuICAgICAgdGhyb3R0bGVUaW1lKDIwMCksXG4gICAgICB0YXAoKCkgPT4gdGhpcy51cGRhdGVTY3JvbGxiYXIoKSksXG4gICAgICAvLyBNYWtlIHN1cmUgc2Nyb2xsYmFyIHRodW1ibmFpbCBwb3NpdGlvbiBpcyBjb3JyZWN0IGFmdGVyIHRoZSBuZXcgY29udGVudCBpcyByZW5kZXJlZFxuICAgICAgZGVib3VuY2VUaW1lKDIwMCksXG4gICAgICB0YXAoKCkgPT4gdGhpcy51cGRhdGVTY3JvbGxiYXIoKSksXG4gICAgKS5zdWJzY3JpYmUoKTtcblxuICAgIC8vIEluaXRpYWxpemUgc2Nyb2xsYmFyXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnVwZGF0ZVNjcm9sbGJhcigpLCAyMDApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fc2Nyb2xsJC51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuX3RodW1iRHJhZyQudW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLl91cGRhdGVPYnNlcnZlciQudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGxiYXIgY2xpY2tcbiAgICogQHBhcmFtIGUgTW91c2UgZXZlbnRcbiAgICovXG4gIG9uU2Nyb2xsYmFyQ2xpY2soZTogYW55KSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSBlLmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgIGNvbnN0IG9mZnNldFlPclggPSBlW3RoaXMuYXhpcy5vZmZzZXRZT3JYXSAtIHRoaXMuX25hdHVyYWxUaHVtYlNpemUgKiAuNTtcbiAgICAgIGNvbnN0IHRodW1iUG9zaXRpb25QZXJjZW50YWdlID0gb2Zmc2V0WU9yWCAqIDEwMCAvIHRoaXMuYmFyLm5hdGl2ZUVsZW1lbnRbdGhpcy5heGlzLmNsaWVudEhlaWdodE9yV2lkdGhdO1xuICAgICAgY29uc3QgdmFsdWUgPSB0aHVtYlBvc2l0aW9uUGVyY2VudGFnZSAqIHRoaXMuX3ZpZXdbdGhpcy5heGlzLnNjcm9sbEhlaWdodE9yV2lkdGhdIC8gMTAwO1xuICAgICAgdGhpcy5uZ1Njcm9sbGJhci5zY3JvbGxUbyh7W3RoaXMuYXhpcy50b3BPckxlZnRdOiB2YWx1ZSwgZHVyYXRpb246IHRoaXMuc2Nyb2xsVG9EdXJhdGlvbn0gYXMgYW55KS5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNjcm9sbGJhclxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVTY3JvbGxiYXIoKSB7XG4gICAgdGhpcy5fdGh1bWJTaXplID0gdGhpcy50aHVtYi5uYXRpdmVFbGVtZW50W3RoaXMuYXhpcy5jbGllbnRIZWlnaHRPcldpZHRoXTtcbiAgICB0aGlzLl90cmFja01heCA9IHRoaXMuYmFyLm5hdGl2ZUVsZW1lbnRbdGhpcy5heGlzLmNsaWVudEhlaWdodE9yV2lkdGhdIC0gdGhpcy5fdGh1bWJTaXplO1xuICAgIHRoaXMuX2N1cnJQb3MgPSB0aGlzLl92aWV3W3RoaXMuYXhpcy5zY3JvbGxUb3BMZWZ0XSAqIHRoaXMuX3RyYWNrTWF4IC8gdGhpcy5fc2Nyb2xsTWF4O1xuICAgIHRoaXMuem9uZS5ydW4oKCkgPT5cbiAgICAgIGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+XG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoe1xuICAgICAgICAgIHRyYW5zZm9ybTogdGhpcy5heGlzLnRyYW5zZm9ybSh0aGlzLl9jdXJyUG9zKSxcbiAgICAgICAgICBbdGhpcy5heGlzLmhlaWdodE9yV2lkdGhdOiBgJHt0aGlzLnRodW1iU2l6ZX1weGBcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHZlcnRpY2FsIHRodW1iIHdvcmtlclxuICAgKi9cbiAgcHJpdmF0ZSBzdGFydFRodW1iRXZlbnRzKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgY29uc3QgbW91c2VEb3duJCA9IGZyb21FdmVudCh0aGlzLnRodW1iLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWRvd24nKTtcbiAgICBjb25zdCBtb3VzZU1vdmUkID0gZnJvbUV2ZW50KHRoaXMuZG9jdW1lbnQsICdtb3VzZW1vdmUnKTtcbiAgICBjb25zdCBtb3VzZVVwJCA9IGZyb21FdmVudCh0aGlzLmRvY3VtZW50LCAnbW91c2V1cCcpLnBpcGUoXG4gICAgICB0YXAoKCkgPT4gdGhpcy5kb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gbnVsbClcbiAgICApO1xuICAgIHJldHVybiBtb3VzZURvd24kLnBpcGUoXG4gICAgICB0YXAoKCkgPT4ge1xuICAgICAgICB0aGlzLmRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZTtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0cmFja01heCBmb3IgYmVmb3JlIHN0YXJ0IGRyYWdnaW5nXG4gICAgICAgIHRoaXMuX3RyYWNrTWF4ID0gdGhpcy5iYXIubmF0aXZlRWxlbWVudFt0aGlzLmF4aXMuY2xpZW50SGVpZ2h0T3JXaWR0aF0gLSB0aGlzLl90aHVtYlNpemU7XG4gICAgICB9KSxcbiAgICAgIHBsdWNrKHRoaXMuYXhpcy5vZmZzZXRZT3JYKSxcbiAgICAgIG1lcmdlTWFwKChtb3VzZURvd25PZmZzZXQ6IG51bWJlcikgPT4gbW91c2VNb3ZlJC5waXBlKFxuICAgICAgICB0YWtlVW50aWwobW91c2VVcCQpLFxuICAgICAgICBwbHVjayh0aGlzLmF4aXMuY2xpZW50WU9yWCksXG4gICAgICAgIHRhcCgobW91c2VNb3ZlQ2xpZW50OiBudW1iZXIpID0+IHtcbiAgICAgICAgICBjb25zdCBvZmZzZXRZT3JYID0gbW91c2VNb3ZlQ2xpZW50IC0gdGhpcy5iYXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVt0aGlzLmF4aXMudG9wT3JMZWZ0XTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3Njcm9sbE1heCAqIChvZmZzZXRZT3JYIC0gbW91c2VEb3duT2Zmc2V0KSAvIHRoaXMuX3RyYWNrTWF4O1xuICAgICAgICAgIHRoaXMubmdTY3JvbGxiYXIuc2Nyb2xsYWJsZS5zY3JvbGxUbyh7W3RoaXMuYXhpcy50b3BPckxlZnRdOiB2YWx1ZX0pO1xuICAgICAgICB9KVxuICAgICAgKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzY3JvbGxiYXIgdGh1bWIgc2l6ZVxuICAgKiBAcGFyYW0gbmF0dXJhbFRodW1iU2l6ZVxuICAgKiBAcGFyYW0gc2Nyb2xsTWF4XG4gICAqL1xuICBwcml2YXRlIHNjcm9sbEJvdW5kYXJpZXMobmF0dXJhbFRodW1iU2l6ZTogbnVtYmVyLCBzY3JvbGxNYXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIChuYXR1cmFsVGh1bWJTaXplIDwgdGhpcy5fbWluVGh1bWJTaXplKSA/IHRoaXMuX21pblRodW1iU2l6ZSA6IHNjcm9sbE1heCA/IG5hdHVyYWxUaHVtYlNpemUgOiAwO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTdGF0ZShzdGF0ZTogYW55KSB7XG4gICAgdGhpcy5fc3RhdGUubmV4dCh7Li4udGhpcy5fc3RhdGUudmFsdWUsIC4uLnN0YXRlfSk7XG4gIH1cbn1cbiJdfQ==