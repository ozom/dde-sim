/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, ViewChild, ElementRef, ChangeDetectionStrategy } from '@angular/core';
import { CdkScrollable } from '@angular/cdk/scrolling';
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';
import { Subject, BehaviorSubject, Subscription } from 'rxjs';
import { map, tap, throttleTime } from 'rxjs/operators';
import { SmoothScroll } from '../smooth-scroll/smooth-scroll';
/**
 * @record
 */
function NgScrollbarState() { }
/** @type {?|undefined} */
NgScrollbarState.prototype.viewStyle;
/** @type {?|undefined} */
NgScrollbarState.prototype.displayX;
/** @type {?|undefined} */
NgScrollbarState.prototype.displayY;
/** @type {?} */
const defaultState = {
    viewStyle: {
        paddingRight: '0',
        paddingBottom: '0',
    },
    displayX: false,
    displayY: false
};
export class NgScrollbar {
    /**
     * @param {?} breakpointObserver
     */
    constructor(breakpointObserver) {
        this.breakpointObserver = breakpointObserver;
        /**
         * Horizontal custom scrollbar
         */
        this.trackX = false;
        /**
         * Vertical custom Scrollbar
         */
        this.trackY = true;
        /**
         * Auto hide scrollbars on mouse leave
         */
        this.autoHide = false;
        /**
         * Auto update scrollbars on content changes (Mutation Observer)
         */
        this.autoUpdate = true;
        /**
         * The smooth scroll duration when a scrollbar is clicked
         */
        this.scrollToDuration = 400;
        /**
         * Disable custom scrollbars on specific breakpoints
         */
        this.disableOnBreakpoints = [
            Breakpoints.HandsetLandscape,
            Breakpoints.HandsetPortrait
        ];
        this.disabled = false;
        /**
         * Scrollbar state
         */
        this._state = new BehaviorSubject(defaultState);
        this.viewStyle = this._state.pipe(map((state) => state.viewStyle));
        this.displayX = this._state.pipe(map((state) => state.displayX));
        this.displayY = this._state.pipe(map((state) => state.displayY));
        /**
         * Mutation observer subscription
         */
        this._updateObserverSub$ = Subscription.EMPTY;
        /**
         * CDK breakpoint subscription
         */
        this._breakpointSub$ = Subscription.EMPTY;
        /**
         * Steam that emits when scrollbar thumbnail needs to update (for internal uses)
         */
        this._updateObserver = new Subject();
        this.updateObserver = this._updateObserver.asObservable();
    }
    /**
     * Disable custom scrollbars and switch back to native scrollbars
     * @param {?} disable
     * @return {?}
     */
    set disableScrollbars(disable) {
        disable ? this.disable() : this.enable();
    }
    /**
     * @return {?}
     */
    get autoHideClass() {
        return this.autoHide;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.view = this.scrollable.getElementRef().nativeElement;
        if (this.disableOnBreakpoints) {
            // Enable/Disable custom scrollbar on breakpoints (Used to disable scrollbars on mobile phones)
            this._breakpointSub$ = this.breakpointObserver.observe(this.disableOnBreakpoints).pipe(
            // filter(() => this.viewInitialized),
            tap((result) => result.matches ? this.disable() : this.enable())).subscribe();
        }
        else {
            this.enable();
        }
        // Update state on content changes
        this._updateObserverSub$ = this.updateObserver.pipe(throttleTime(200), tap(() => this.updateState())).subscribe();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._breakpointSub$.unsubscribe();
        this._updateObserverSub$.unsubscribe();
        if (this._observer) {
            this._observer.disconnect();
        }
    }
    /**
     * Update scrollbar thumbnail position
     * @return {?}
     */
    update() {
        if (!this.disabled) {
            this._updateObserver.next();
        }
    }
    /**
     * Enable custom scrollbar
     * @return {?}
     */
    enable() {
        if (this.view) {
            this.disabled = false;
            // Hide native scrollbars
            this._nativeScrollbarSize = `${this.view.offsetWidth - this.view.clientWidth + 1}px`;
            this.updateState();
            if (this.autoUpdate) {
                // Observe content changes
                this._observer = new MutationObserver(() => this.update());
                this._observer.observe(this.view, { subtree: true, childList: true, characterData: true });
            }
        }
    }
    /**
     * Disable custom scrollbar
     * @return {?}
     */
    disable() {
        this.disabled = true;
        // Show Native Scrollbars
        this.resetState();
        if (this._observer) {
            this._observer.disconnect();
        }
    }
    /**
     * @param {?} options
     * @return {?}
     */
    scrollTo(options) {
        return this.smoothScroll.scrollTo(options);
    }
    /**
     * @param {?} selector
     * @param {?=} offset
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollToElement(selector, offset = 0, duration, easeFunc) {
        return this.smoothScroll.scrollToElement(selector, offset, duration, easeFunc);
    }
    /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollXTo(to, duration, easeFunc) {
        return this.smoothScroll.scrollXTo(to, duration, easeFunc);
    }
    /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollYTo(to, duration, easeFunc) {
        return this.smoothScroll.scrollYTo(to, duration, easeFunc);
    }
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollToTop(duration, easeFunc) {
        return this.smoothScroll.scrollToTop(duration, easeFunc);
    }
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollToBottom(duration, easeFunc) {
        return this.smoothScroll.scrollToBottom(duration, easeFunc);
    }
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollToRight(duration, easeFunc) {
        return this.smoothScroll.scrollToRight(duration, easeFunc);
    }
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    scrollToLeft(duration, easeFunc) {
        return this.smoothScroll.scrollToLeft(duration, easeFunc);
    }
    /**
     * @return {?}
     */
    updateState() {
        /** @type {?} */
        let paddingBottom = '0';
        /** @type {?} */
        let paddingRight = '0';
        /** @type {?} */
        let displayY = false;
        /** @type {?} */
        let displayX = false;
        /** @type {?} */
        const size = `calc(100% + ${this._nativeScrollbarSize})`;
        if (this.trackY) {
            // Check if vertical scrollbar should be displayed
            if (this.view.scrollHeight > this.view.clientHeight) {
                displayY = true;
                paddingRight = this.overlay ? '0' : this._nativeScrollbarSize;
            }
        }
        if (this.trackX) {
            // Check if horizontal scrollbar should be displayed
            if (this.view.scrollWidth > this.view.clientWidth) {
                displayX = true;
                paddingBottom = this.overlay ? '0' : this._nativeScrollbarSize;
            }
        }
        this._state.next({
            viewStyle: {
                width: size,
                height: size,
                paddingBottom,
                paddingRight
            },
            displayX,
            displayY
        });
    }
    /**
     * @return {?}
     */
    resetState() {
        this._state.next({
            viewStyle: Object.assign({}, this._state.value.viewStyle, defaultState.viewStyle),
            displayX: defaultState.displayX,
            displayY: defaultState.displayY
        });
    }
}
NgScrollbar.decorators = [
    { type: Component, args: [{
                selector: 'ng-scrollbar',
                template: "<div class=\"ng-scrollbar-container\">\r\n\r\n  <div cdkScrollable smoothScroll class=\"ng-scrollbar-view {{viewClass}}\" [ngStyle]=\"viewStyle | async\">\r\n    <ng-content></ng-content>\r\n  </div>\r\n\r\n  <ng-scrollbar-thumb #vertical\r\n                      *ngIf=\"!disabled && trackY\"\r\n                      orientation=\"vertical\"\r\n                      [class.ng-scrollbar-visible]=\"displayY | async\"\r\n                      [barClass]=\"barClass\"\r\n                      [thumbClass]=\"thumbClass\"\r\n                      [scrollToDuration]=\"scrollToDuration\">\r\n  </ng-scrollbar-thumb>\r\n\r\n  <ng-scrollbar-thumb #horizontal\r\n                      *ngIf=\"!disabled && trackX\"\r\n                      orientation=\"horizontal\"\r\n                      [class.ng-scrollbar-visible]=\"displayX | async\"\r\n                      [barClass]=\"barClass\"\r\n                      [thumbClass]=\"thumbClass\"\r\n                      [scrollToDuration]=\"scrollToDuration\">\r\n  </ng-scrollbar-thumb>\r\n\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{display:block;overflow:hidden}.ng-scrollbar-container,.ng-scrollbar-view,:host{position:relative;height:100%;width:100%}.ng-scrollbar-container{overflow:hidden;top:0;left:0}.ng-scrollbar-view{overflow:scroll;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-overflow-scrolling:touch}.ng-scrollbar-view ::-webkit-scrollbar{background:0 0}ng-scrollbar-thumb{display:none}ng-scrollbar-thumb.ng-scrollbar-visible{display:block}::ng-deep .ng-scrollbar-auto-hide .ng-scrollbar{opacity:0;transition:opacity 120ms ease-out}::ng-deep .ng-scrollbar-auto-hide:active .ng-scrollbar,::ng-deep .ng-scrollbar-auto-hide:focus .ng-scrollbar,::ng-deep .ng-scrollbar-auto-hide:hover .ng-scrollbar{opacity:1;transition:opacity 340ms ease-out}::ng-deep .ng-scrollbar{position:absolute;z-index:1;border-radius:4px}::ng-deep .ng-scrollbar-thumb{position:relative;width:0;height:0;border-radius:inherit;background-color:rgba(0,0,0,.2);-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);transition:height 150ms ease-out}::ng-deep .ng-scrollbar-thumb:active,::ng-deep .ng-scrollbar-thumb:hover{background-color:rgba(0,0,0,.3)}::ng-deep .ng-scrollbar-vertical{right:6px;top:6px;bottom:6px;width:8px}::ng-deep .ng-scrollbar-vertical .ng-scrollbar-thumb{width:100%}::ng-deep .ng-scrollbar-horizontal{left:6px;right:6px;bottom:6px;height:8px}::ng-deep .ng-scrollbar-horizontal .ng-scrollbar-thumb{height:100%}"]
            }] }
];
/** @nocollapse */
NgScrollbar.ctorParameters = () => [
    { type: BreakpointObserver }
];
NgScrollbar.propDecorators = {
    trackX: [{ type: Input }],
    trackY: [{ type: Input }],
    autoHide: [{ type: Input }],
    autoUpdate: [{ type: Input }],
    viewClass: [{ type: Input }],
    barClass: [{ type: Input }],
    thumbClass: [{ type: Input }],
    scrollToDuration: [{ type: Input }],
    overlay: [{ type: Input }],
    disableOnBreakpoints: [{ type: Input }],
    disableScrollbars: [{ type: Input, args: ['disabled',] }],
    scrollable: [{ type: ViewChild, args: [CdkScrollable,] }],
    smoothScroll: [{ type: ViewChild, args: [SmoothScroll,] }],
    verticalScrollbar: [{ type: ViewChild, args: ['vertical', { read: ElementRef },] }],
    horizontalScrollbar: [{ type: ViewChild, args: ['horizontal', { read: ElementRef },] }],
    autoHideClass: [{ type: HostBinding, args: ['class.ng-scrollbar-auto-hide',] }]
};
if (false) {
    /**
     * Horizontal custom scrollbar
     * @type {?}
     */
    NgScrollbar.prototype.trackX;
    /**
     * Vertical custom Scrollbar
     * @type {?}
     */
    NgScrollbar.prototype.trackY;
    /**
     * Auto hide scrollbars on mouse leave
     * @type {?}
     */
    NgScrollbar.prototype.autoHide;
    /**
     * Auto update scrollbars on content changes (Mutation Observer)
     * @type {?}
     */
    NgScrollbar.prototype.autoUpdate;
    /**
     * Viewport class
     * @type {?}
     */
    NgScrollbar.prototype.viewClass;
    /**
     * Scrollbars class
     * @type {?}
     */
    NgScrollbar.prototype.barClass;
    /**
     * Scrollbars thumbnails class
     * @type {?}
     */
    NgScrollbar.prototype.thumbClass;
    /**
     * The smooth scroll duration when a scrollbar is clicked
     * @type {?}
     */
    NgScrollbar.prototype.scrollToDuration;
    /**
     * Use overlay scrollbars
     * @type {?}
     */
    NgScrollbar.prototype.overlay;
    /**
     * Disable custom scrollbars on specific breakpoints
     * @type {?}
     */
    NgScrollbar.prototype.disableOnBreakpoints;
    /** @type {?} */
    NgScrollbar.prototype.disabled;
    /** @type {?} */
    NgScrollbar.prototype.scrollable;
    /** @type {?} */
    NgScrollbar.prototype.smoothScroll;
    /** @type {?} */
    NgScrollbar.prototype.verticalScrollbar;
    /** @type {?} */
    NgScrollbar.prototype.horizontalScrollbar;
    /**
     * Native scrollbar size
     * @type {?}
     */
    NgScrollbar.prototype._nativeScrollbarSize;
    /**
     * Scrollbar state
     * @type {?}
     */
    NgScrollbar.prototype._state;
    /** @type {?} */
    NgScrollbar.prototype.viewStyle;
    /** @type {?} */
    NgScrollbar.prototype.displayX;
    /** @type {?} */
    NgScrollbar.prototype.displayY;
    /**
     * Mutation observer subscription
     * @type {?}
     */
    NgScrollbar.prototype._updateObserverSub$;
    /**
     * CDK breakpoint subscription
     * @type {?}
     */
    NgScrollbar.prototype._breakpointSub$;
    /**
     * Viewport Element
     * @type {?}
     */
    NgScrollbar.prototype.view;
    /**
     * Observe content changes
     * @type {?}
     */
    NgScrollbar.prototype._observer;
    /**
     * Steam that emits when scrollbar thumbnail needs to update (for internal uses)
     * @type {?}
     */
    NgScrollbar.prototype._updateObserver;
    /** @type {?} */
    NgScrollbar.prototype.updateObserver;
    /** @type {?} */
    NgScrollbar.prototype.breakpointObserver;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjcm9sbGJhci8iLCJzb3VyY2VzIjpbInNjcm9sbGJhci9uZy1zY3JvbGxiYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQTRCLFVBQVUsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4SSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBbUIsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RixPQUFPLEVBQWMsT0FBTyxFQUFFLGVBQWUsRUFBRSxZQUFZLEVBQW9CLE1BQU0sTUFBTSxDQUFDO0FBQzVGLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxZQUFZLEVBQXdCLE1BQU0sZ0NBQWdDLENBQUM7Ozs7Ozs7Ozs7OztBQWFwRixNQUFNLFlBQVksR0FBcUI7SUFDckMsU0FBUyxFQUFFO1FBQ1QsWUFBWSxFQUFFLEdBQUc7UUFDakIsYUFBYSxFQUFFLEdBQUc7S0FDbkI7SUFDRCxRQUFRLEVBQUUsS0FBSztJQUNmLFFBQVEsRUFBRSxLQUFLO0NBQ2hCLENBQUM7QUFRRixNQUFNLE9BQU8sV0FBVzs7OztJQWdFdEIsWUFBb0Isa0JBQXNDO1FBQXRDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7Ozs7UUE3RDFELGNBQWtCLEtBQUssQ0FBQzs7OztRQUV4QixjQUFrQixJQUFJLENBQUM7Ozs7UUFFdkIsZ0JBQW9CLEtBQUssQ0FBQzs7OztRQUUxQixrQkFBc0IsSUFBSSxDQUFDOzs7O1FBUTNCLHdCQUE0QixHQUFHLENBQUM7Ozs7UUFJaEMsNEJBQWdDO1lBQzlCLFdBQVcsQ0FBQyxnQkFBZ0I7WUFDNUIsV0FB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QVUsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUM7a0NBQ3hDLFNBQVMsU0FBQyxZQUFZLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFDOzRCQUUxQyxXQUFXLFNBQUMsOEJBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgSG9zdEJpbmRpbmcsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDZGtTY3JvbGxhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Njcm9sbGluZyc7XHJcbmltcG9ydCB7IEJyZWFrcG9pbnRPYnNlcnZlciwgQnJlYWtwb2ludHMsIEJyZWFrcG9pbnRTdGF0ZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9sYXlvdXQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBCZWhhdmlvclN1YmplY3QsIFN1YnNjcmlwdGlvbiwgU3Vic2NyaXB0aW9uTGlrZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAsIHRhcCwgdGhyb3R0bGVUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTbW9vdGhTY3JvbGwsIFNtb290aFNjcm9sbEVhc2VGdW5jIH0gZnJvbSAnLi4vc21vb3RoLXNjcm9sbC9zbW9vdGgtc2Nyb2xsJztcclxuXHJcbmludGVyZmFjZSBOZ1Njcm9sbGJhclN0YXRlIHtcclxuICB2aWV3U3R5bGU/OiB7XHJcbiAgICB3aWR0aD86IHN0cmluZztcclxuICAgIGhlaWdodD86IHN0cmluZztcclxuICAgIHBhZGRpbmdSaWdodD86IHN0cmluZztcclxuICAgIHBhZGRpbmdCb3R0b20/OiBzdHJpbmc7XHJcbiAgfTtcclxuICBkaXNwbGF5WD86IGJvb2xlYW47XHJcbiAgZGlzcGxheVk/OiBib29sZWFuO1xyXG59XHJcblxyXG5jb25zdCBkZWZhdWx0U3RhdGU6IE5nU2Nyb2xsYmFyU3RhdGUgPSB7XHJcbiAgdmlld1N0eWxlOiB7XHJcbiAgICBwYWRkaW5nUmlnaHQ6ICcwJyxcclxuICAgIHBhZGRpbmdCb3R0b206ICcwJyxcclxuICB9LFxyXG4gIGRpc3BsYXlYOiBmYWxzZSxcclxuICBkaXNwbGF5WTogZmFsc2VcclxufTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbmctc2Nyb2xsYmFyJyxcclxuICB0ZW1wbGF0ZVVybDogJ25nLXNjcm9sbGJhci5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnbmctc2Nyb2xsYmFyLnNjc3MnXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdTY3JvbGxiYXIgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAvKiogSG9yaXpvbnRhbCBjdXN0b20gc2Nyb2xsYmFyICovXHJcbiAgQElucHV0KCkgdHJhY2tYID0gZmFsc2U7XHJcbiAgLyoqIFZlcnRpY2FsIGN1c3RvbSBTY3JvbGxiYXIgKi9cclxuICBASW5wdXQoKSB0cmFja1kgPSB0cnVlO1xyXG4gIC8qKiBBdXRvIGhpZGUgc2Nyb2xsYmFycyBvbiBtb3VzZSBsZWF2ZSAqL1xyXG4gIEBJbnB1dCgpIGF1dG9IaWRlID0gZmFsc2U7XHJcbiAgLyoqIEF1dG8gdXBkYXRlIHNjcm9sbGJhcnMgb24gY29udGVudCBjaGFuZ2VzIChNdXRhdGlvbiBPYnNlcnZlcikgKi9cclxuICBASW5wdXQoKSBhdXRvVXBkYXRlID0gdHJ1ZTtcclxuICAvKiogVmlld3BvcnQgY2xhc3MgKi9cclxuICBASW5wdXQoKSB2aWV3Q2xhc3M6IHN0cmluZztcclxuICAvKiogU2Nyb2xsYmFycyBjbGFzcyAqL1xyXG4gIEBJbnB1dCgpIGJhckNsYXNzOiBzdHJpbmc7XHJcbiAgLyoqIFNjcm9sbGJhcnMgdGh1bWJuYWlscyBjbGFzcyAqL1xyXG4gIEBJbnB1dCgpIHRodW1iQ2xhc3M6IHN0cmluZztcclxuICAvKiogVGhlIHNtb290aCBzY3JvbGwgZHVyYXRpb24gd2hlbiBhIHNjcm9sbGJhciBpcyBjbGlja2VkICovXHJcbiAgQElucHV0KCkgc2Nyb2xsVG9EdXJhdGlvbiA9IDQwMDtcclxuICAvKiogVXNlIG92ZXJsYXkgc2Nyb2xsYmFycyAqL1xyXG4gIEBJbnB1dCgpIG92ZXJsYXk6IGJvb2xlYW47XHJcbiAgLyoqIERpc2FibGUgY3VzdG9tIHNjcm9sbGJhcnMgb24gc3BlY2lmaWMgYnJlYWtwb2ludHMgKi9cclxuICBASW5wdXQoKSBkaXNhYmxlT25CcmVha3BvaW50cyA9IFtcclxuICAgIEJyZWFrcG9pbnRzLkhhbmRzZXRMYW5kc2NhcGUsXHJcbiAgICBCcmVha3BvaW50cy5IYW5kc2V0UG9ydHJhaXRcclxuICBdO1xyXG5cclxuICAvKiogRGlzYWJsZSBjdXN0b20gc2Nyb2xsYmFycyBhbmQgc3dpdGNoIGJhY2sgdG8gbmF0aXZlIHNjcm9sbGJhcnMgKi9cclxuICBASW5wdXQoJ2Rpc2FibGVkJykgc2V0IGRpc2FibGVTY3JvbGxiYXJzKGRpc2FibGU6IGJvb2xlYW4pIHtcclxuICAgIGRpc2FibGUgPyB0aGlzLmRpc2FibGUoKSA6IHRoaXMuZW5hYmxlKCk7XHJcbiAgfVxyXG5cclxuICBkaXNhYmxlZCA9IGZhbHNlO1xyXG5cclxuICBAVmlld0NoaWxkKENka1Njcm9sbGFibGUpIHNjcm9sbGFibGU6IENka1Njcm9sbGFibGU7XHJcbiAgQFZpZXdDaGlsZChTbW9vdGhTY3JvbGwpIHNtb290aFNjcm9sbDogU21vb3RoU2Nyb2xsO1xyXG4gIEBWaWV3Q2hpbGQoJ3ZlcnRpY2FsJywge3JlYWQ6IEVsZW1lbnRSZWZ9KSB2ZXJ0aWNhbFNjcm9sbGJhcjogRWxlbWVudFJlZjtcclxuICBAVmlld0NoaWxkKCdob3Jpem9udGFsJywge3JlYWQ6IEVsZW1lbnRSZWZ9KSBob3Jpem9udGFsU2Nyb2xsYmFyOiBFbGVtZW50UmVmO1xyXG5cclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm5nLXNjcm9sbGJhci1hdXRvLWhpZGUnKSBnZXQgYXV0b0hpZGVDbGFzcygpIHtcclxuICAgIHJldHVybiB0aGlzLmF1dG9IaWRlO1xyXG4gIH1cclxuXHJcbiAgLyoqIE5hdGl2ZSBzY3JvbGxiYXIgc2l6ZSAqL1xyXG4gIHByaXZhdGUgX25hdGl2ZVNjcm9sbGJhclNpemU6IHN0cmluZztcclxuXHJcbiAgLyoqIFNjcm9sbGJhciBzdGF0ZSAqL1xyXG4gIHByaXZhdGUgX3N0YXRlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxOZ1Njcm9sbGJhclN0YXRlPihkZWZhdWx0U3RhdGUpO1xyXG4gIHZpZXdTdHlsZTogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5fc3RhdGUucGlwZShtYXAoKHN0YXRlOiBOZ1Njcm9sbGJhclN0YXRlKSA9PiBzdGF0ZS52aWV3U3R5bGUpKTtcclxuICBkaXNwbGF5WDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuX3N0YXRlLnBpcGUobWFwKChzdGF0ZTogTmdTY3JvbGxiYXJTdGF0ZSkgPT4gc3RhdGUuZGlzcGxheVgpKTtcclxuICBkaXNwbGF5WTogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuX3N0YXRlLnBpcGUobWFwKChzdGF0ZTogTmdTY3JvbGxiYXJTdGF0ZSkgPT4gc3RhdGUuZGlzcGxheVkpKTtcclxuXHJcbiAgLyoqIE11dGF0aW9uIG9ic2VydmVyIHN1YnNjcmlwdGlvbiAqL1xyXG4gIHByaXZhdGUgX3VwZGF0ZU9ic2VydmVyU3ViJDogU3Vic2NyaXB0aW9uTGlrZSA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcclxuICAvKiogQ0RLIGJyZWFrcG9pbnQgc3Vic2NyaXB0aW9uICovXHJcbiAgcHJpdmF0ZSBfYnJlYWtwb2ludFN1YiQ6IFN1YnNjcmlwdGlvbkxpa2UgPSBTdWJzY3JpcHRpb24uRU1QVFk7XHJcbiAgLyoqIFZpZXdwb3J0IEVsZW1lbnQgKi9cclxuICB2aWV3OiBIVE1MRWxlbWVudDtcclxuICAvKiogT2JzZXJ2ZSBjb250ZW50IGNoYW5nZXMgKi9cclxuICBwcml2YXRlIF9vYnNlcnZlcjogTXV0YXRpb25PYnNlcnZlcjtcclxuXHJcbiAgLyoqIFN0ZWFtIHRoYXQgZW1pdHMgd2hlbiBzY3JvbGxiYXIgdGh1bWJuYWlsIG5lZWRzIHRvIHVwZGF0ZSAoZm9yIGludGVybmFsIHVzZXMpICovXHJcbiAgcHJpdmF0ZSBfdXBkYXRlT2JzZXJ2ZXIgPSBuZXcgU3ViamVjdCgpO1xyXG4gIHVwZGF0ZU9ic2VydmVyID0gdGhpcy5fdXBkYXRlT2JzZXJ2ZXIuYXNPYnNlcnZhYmxlKCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYnJlYWtwb2ludE9ic2VydmVyOiBCcmVha3BvaW50T2JzZXJ2ZXIpIHtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIHRoaXMudmlldyA9IHRoaXMuc2Nyb2xsYWJsZS5nZXRFbGVtZW50UmVmKCkubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICBpZiAodGhpcy5kaXNhYmxlT25CcmVha3BvaW50cykge1xyXG4gICAgICAvLyBFbmFibGUvRGlzYWJsZSBjdXN0b20gc2Nyb2xsYmFyIG9uIGJyZWFrcG9pbnRzIChVc2VkIHRvIGRpc2FibGUgc2Nyb2xsYmFycyBvbiBtb2JpbGUgcGhvbmVzKVxyXG4gICAgICB0aGlzLl9icmVha3BvaW50U3ViJCA9IHRoaXMuYnJlYWtwb2ludE9ic2VydmVyLm9ic2VydmUodGhpcy5kaXNhYmxlT25CcmVha3BvaW50cykucGlwZShcclxuICAgICAgICAvLyBmaWx0ZXIoKCkgPT4gdGhpcy52aWV3SW5pdGlhbGl6ZWQpLFxyXG4gICAgICAgIHRhcCgocmVzdWx0OiBCcmVha3BvaW50U3RhdGUpID0+IHJlc3VsdC5tYXRjaGVzID8gdGhpcy5kaXNhYmxlKCkgOiB0aGlzLmVuYWJsZSgpKVxyXG4gICAgICApLnN1YnNjcmliZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5lbmFibGUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgc3RhdGUgb24gY29udGVudCBjaGFuZ2VzXHJcbiAgICB0aGlzLl91cGRhdGVPYnNlcnZlclN1YiQgPSB0aGlzLnVwZGF0ZU9ic2VydmVyLnBpcGUoXHJcbiAgICAgIHRocm90dGxlVGltZSgyMDApLFxyXG4gICAgICB0YXAoKCkgPT4gdGhpcy51cGRhdGVTdGF0ZSgpKVxyXG4gICAgKS5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5fYnJlYWtwb2ludFN1YiQudW5zdWJzY3JpYmUoKTtcclxuICAgIHRoaXMuX3VwZGF0ZU9ic2VydmVyU3ViJC51bnN1YnNjcmliZSgpO1xyXG4gICAgaWYgKHRoaXMuX29ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMuX29ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBzY3JvbGxiYXIgdGh1bWJuYWlsIHBvc2l0aW9uXHJcbiAgICovXHJcbiAgdXBkYXRlKCkge1xyXG4gICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMuX3VwZGF0ZU9ic2VydmVyLm5leHQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVuYWJsZSBjdXN0b20gc2Nyb2xsYmFyXHJcbiAgICovXHJcbiAgZW5hYmxlKCkge1xyXG4gICAgaWYgKHRoaXMudmlldykge1xyXG4gICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIC8vIEhpZGUgbmF0aXZlIHNjcm9sbGJhcnNcclxuICAgICAgdGhpcy5fbmF0aXZlU2Nyb2xsYmFyU2l6ZSA9IGAke3RoaXMudmlldy5vZmZzZXRXaWR0aCAtIHRoaXMudmlldy5jbGllbnRXaWR0aCArIDF9cHhgO1xyXG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKCk7XHJcblxyXG4gICAgICBpZiAodGhpcy5hdXRvVXBkYXRlKSB7XHJcbiAgICAgICAgLy8gT2JzZXJ2ZSBjb250ZW50IGNoYW5nZXNcclxuICAgICAgICB0aGlzLl9vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHRoaXMudXBkYXRlKCkpO1xyXG4gICAgICAgIHRoaXMuX29ic2VydmVyLm9ic2VydmUodGhpcy52aWV3LCB7c3VidHJlZTogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlLCBjaGFyYWN0ZXJEYXRhOiB0cnVlfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERpc2FibGUgY3VzdG9tIHNjcm9sbGJhclxyXG4gICAqL1xyXG4gIGRpc2FibGUoKSB7XHJcbiAgICB0aGlzLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIC8vIFNob3cgTmF0aXZlIFNjcm9sbGJhcnNcclxuICAgIHRoaXMucmVzZXRTdGF0ZSgpO1xyXG4gICAgaWYgKHRoaXMuX29ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMuX29ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNjcm9sbFRvKG9wdGlvbnM6IFNjcm9sbFRvT3B0aW9ucyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsVG9FbGVtZW50KHNlbGVjdG9yOiBzdHJpbmcsIG9mZnNldCA9IDAsIGR1cmF0aW9uPzogbnVtYmVyLCBlYXNlRnVuYz86IFNtb290aFNjcm9sbEVhc2VGdW5jKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsVG9FbGVtZW50KHNlbGVjdG9yLCBvZmZzZXQsIGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBzY3JvbGxYVG8odG86IG51bWJlciwgZHVyYXRpb24/OiBudW1iZXIsIGVhc2VGdW5jPzogU21vb3RoU2Nyb2xsRWFzZUZ1bmMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxYVG8odG8sIGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBzY3JvbGxZVG8odG86IG51bWJlciwgZHVyYXRpb24/OiBudW1iZXIsIGVhc2VGdW5jPzogU21vb3RoU2Nyb2xsRWFzZUZ1bmMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxZVG8odG8sIGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBzY3JvbGxUb1RvcChkdXJhdGlvbj86IG51bWJlciwgZWFzZUZ1bmM/OiBTbW9vdGhTY3JvbGxFYXNlRnVuYyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvVG9wKGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBzY3JvbGxUb0JvdHRvbShkdXJhdGlvbj86IG51bWJlciwgZWFzZUZ1bmM/OiBTbW9vdGhTY3JvbGxFYXNlRnVuYyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvQm90dG9tKGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBzY3JvbGxUb1JpZ2h0KGR1cmF0aW9uPzogbnVtYmVyLCBlYXNlRnVuYz86IFNtb290aFNjcm9sbEVhc2VGdW5jKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsVG9SaWdodChkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsVG9MZWZ0KGR1cmF0aW9uPzogbnVtYmVyLCBlYXNlRnVuYz86IFNtb290aFNjcm9sbEVhc2VGdW5jKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsVG9MZWZ0KGR1cmF0aW9uLCBlYXNlRnVuYyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZVN0YXRlKCkge1xyXG4gICAgbGV0IHBhZGRpbmdCb3R0b20gPSAnMCcsIHBhZGRpbmdSaWdodCA9ICcwJywgZGlzcGxheVkgPSBmYWxzZSwgZGlzcGxheVggPSBmYWxzZTtcclxuICAgIGNvbnN0IHNpemUgPSBgY2FsYygxMDAlICsgJHt0aGlzLl9uYXRpdmVTY3JvbGxiYXJTaXplfSlgO1xyXG4gICAgaWYgKHRoaXMudHJhY2tZKSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIHZlcnRpY2FsIHNjcm9sbGJhciBzaG91bGQgYmUgZGlzcGxheWVkXHJcbiAgICAgIGlmICh0aGlzLnZpZXcuc2Nyb2xsSGVpZ2h0ID4gdGhpcy52aWV3LmNsaWVudEhlaWdodCkge1xyXG4gICAgICAgIGRpc3BsYXlZID0gdHJ1ZTtcclxuICAgICAgICBwYWRkaW5nUmlnaHQgPSB0aGlzLm92ZXJsYXkgPyAnMCcgOiB0aGlzLl9uYXRpdmVTY3JvbGxiYXJTaXplO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy50cmFja1gpIHtcclxuICAgICAgLy8gQ2hlY2sgaWYgaG9yaXpvbnRhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgICBpZiAodGhpcy52aWV3LnNjcm9sbFdpZHRoID4gdGhpcy52aWV3LmNsaWVudFdpZHRoKSB7XHJcbiAgICAgICAgZGlzcGxheVggPSB0cnVlO1xyXG4gICAgICAgIHBhZGRpbmdCb3R0b20gPSB0aGlzLm92ZXJsYXkgPyAnMCcgOiB0aGlzLl9uYXRpdmVTY3JvbGxiYXJTaXplO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLl9zdGF0ZS5uZXh0KHtcclxuICAgICAgdmlld1N0eWxlOiB7XHJcbiAgICAgICAgd2lkdGg6IHNpemUsXHJcbiAgICAgICAgaGVpZ2h0OiBzaXplLFxyXG4gICAgICAgIHBhZGRpbmdCb3R0b20sXHJcbiAgICAgICAgcGFkZGluZ1JpZ2h0XHJcbiAgICAgIH0sXHJcbiAgICAgIGRpc3BsYXlYLFxyXG4gICAgICBkaXNwbGF5WVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlc2V0U3RhdGUoKSB7XHJcbiAgICB0aGlzLl9zdGF0ZS5uZXh0KHtcclxuICAgICAgdmlld1N0eWxlOiB7XHJcbiAgICAgICAgLi4udGhpcy5fc3RhdGUudmFsdWUudmlld1N0eWxlLFxyXG4gICAgICAgIC4uLmRlZmF1bHRTdGF0ZS52aWV3U3R5bGVcclxuICAgICAgfSxcclxuICAgICAgZGlzcGxheVg6IGRlZmF1bHRTdGF0ZS5kaXNwbGF5WCxcclxuICAgICAgZGlzcGxheVk6IGRlZmF1bHRTdGF0ZS5kaXNwbGF5WVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=