/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, HostBinding, ViewChild, ElementRef, ChangeDetectionStrategy } from '@angular/core';
import { CdkScrollable } from '@angular/cdk/scrolling';
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';
import { Subject, BehaviorSubject, Subscription } from 'rxjs';
import { map, tap, throttleTime } from 'rxjs/operators';
import { SmoothScroll } from '../smooth-scroll/smooth-scroll';
/**
 * @record
 */
function NgScrollbarState() { }
/** @type {?|undefined} */
NgScrollbarState.prototype.viewStyle;
/** @type {?|undefined} */
NgScrollbarState.prototype.displayX;
/** @type {?|undefined} */
NgScrollbarState.prototype.displayY;
/** @type {?} */
var defaultState = {
    viewStyle: {
        paddingRight: '0',
        paddingBottom: '0',
    },
    displayX: false,
    displayY: false
};
var NgScrollbar = /** @class */ (function () {
    function NgScrollbar(breakpointObserver) {
        this.breakpointObserver = breakpointObserver;
        /**
         * Horizontal custom scrollbar
         */
        this.trackX = false;
        /**
         * Vertical custom Scrollbar
         */
        this.trackY = true;
        /**
         * Auto hide scrollbars on mouse leave
         */
        this.autoHide = false;
        /**
         * Auto update scrollbars on content changes (Mutation Observer)
         */
        this.autoUpdate = true;
        /**
         * The smooth scroll duration when a scrollbar is clicked
         */
        this.scrollToDuration = 400;
        /**
         * Disable custom scrollbars on specific breakpoints
         */
        this.disableOnBreakpoints = [
            Breakpoints.HandsetLandscape,
            Breakpoints.HandsetPortrait
        ];
        this.disabled = false;
        /**
         * Scrollbar state
         */
        this._state = new BehaviorSubject(defaultState);
        this.viewStyle = this._state.pipe(map(function (state) { return state.viewStyle; }));
        this.displayX = this._state.pipe(map(function (state) { return state.displayX; }));
        this.displayY = this._state.pipe(map(function (state) { return state.displayY; }));
        /**
         * Mutation observer subscription
         */
        this._updateObserverSub$ = Subscription.EMPTY;
        /**
         * CDK breakpoint subscription
         */
        this._breakpointSub$ = Subscription.EMPTY;
        /**
         * Steam that emits when scrollbar thumbnail needs to update (for internal uses)
         */
        this._updateObserver = new Subject();
        this.updateObserver = this._updateObserver.asObservable();
    }
    Object.defineProperty(NgScrollbar.prototype, "disableScrollbars", {
        /** Disable custom scrollbars and switch back to native scrollbars */
        set: /**
         * Disable custom scrollbars and switch back to native scrollbars
         * @param {?} disable
         * @return {?}
         */
        function (disable) {
            disable ? this.disable() : this.enable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgScrollbar.prototype, "autoHideClass", {
        get: /**
         * @return {?}
         */
        function () {
            return this.autoHide;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgScrollbar.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.view = this.scrollable.getElementRef().nativeElement;
        if (this.disableOnBreakpoints) {
            // Enable/Disable custom scrollbar on breakpoints (Used to disable scrollbars on mobile phones)
            this._breakpointSub$ = this.breakpointObserver.observe(this.disableOnBreakpoints).pipe(
            // filter(() => this.viewInitialized),
            tap(function (result) { return result.matches ? _this.disable() : _this.enable(); })).subscribe();
        }
        else {
            this.enable();
        }
        // Update state on content changes
        this._updateObserverSub$ = this.updateObserver.pipe(throttleTime(200), tap(function () { return _this.updateState(); })).subscribe();
    };
    /**
     * @return {?}
     */
    NgScrollbar.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._breakpointSub$.unsubscribe();
        this._updateObserverSub$.unsubscribe();
        if (this._observer) {
            this._observer.disconnect();
        }
    };
    /**
     * Update scrollbar thumbnail position
     */
    /**
     * Update scrollbar thumbnail position
     * @return {?}
     */
    NgScrollbar.prototype.update = /**
     * Update scrollbar thumbnail position
     * @return {?}
     */
    function () {
        if (!this.disabled) {
            this._updateObserver.next();
        }
    };
    /**
     * Enable custom scrollbar
     */
    /**
     * Enable custom scrollbar
     * @return {?}
     */
    NgScrollbar.prototype.enable = /**
     * Enable custom scrollbar
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.view) {
            this.disabled = false;
            // Hide native scrollbars
            this._nativeScrollbarSize = this.view.offsetWidth - this.view.clientWidth + 1 + "px";
            this.updateState();
            if (this.autoUpdate) {
                // Observe content changes
                this._observer = new MutationObserver(function () { return _this.update(); });
                this._observer.observe(this.view, { subtree: true, childList: true, characterData: true });
            }
        }
    };
    /**
     * Disable custom scrollbar
     */
    /**
     * Disable custom scrollbar
     * @return {?}
     */
    NgScrollbar.prototype.disable = /**
     * Disable custom scrollbar
     * @return {?}
     */
    function () {
        this.disabled = true;
        // Show Native Scrollbars
        this.resetState();
        if (this._observer) {
            this._observer.disconnect();
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    NgScrollbar.prototype.scrollTo = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return this.smoothScroll.scrollTo(options);
    };
    /**
     * @param {?} selector
     * @param {?=} offset
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollToElement = /**
     * @param {?} selector
     * @param {?=} offset
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (selector, offset, duration, easeFunc) {
        if (offset === void 0) { offset = 0; }
        return this.smoothScroll.scrollToElement(selector, offset, duration, easeFunc);
    };
    /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollXTo = /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (to, duration, easeFunc) {
        return this.smoothScroll.scrollXTo(to, duration, easeFunc);
    };
    /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollYTo = /**
     * @param {?} to
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (to, duration, easeFunc) {
        return this.smoothScroll.scrollYTo(to, duration, easeFunc);
    };
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollToTop = /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (duration, easeFunc) {
        return this.smoothScroll.scrollToTop(duration, easeFunc);
    };
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollToBottom = /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (duration, easeFunc) {
        return this.smoothScroll.scrollToBottom(duration, easeFunc);
    };
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollToRight = /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (duration, easeFunc) {
        return this.smoothScroll.scrollToRight(duration, easeFunc);
    };
    /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    NgScrollbar.prototype.scrollToLeft = /**
     * @param {?=} duration
     * @param {?=} easeFunc
     * @return {?}
     */
    function (duration, easeFunc) {
        return this.smoothScroll.scrollToLeft(duration, easeFunc);
    };
    /**
     * @return {?}
     */
    NgScrollbar.prototype.updateState = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paddingBottom = '0';
        /** @type {?} */
        var paddingRight = '0';
        /** @type {?} */
        var displayY = false;
        /** @type {?} */
        var displayX = false;
        /** @type {?} */
        var size = "calc(100% + " + this._nativeScrollbarSize + ")";
        if (this.trackY) {
            // Check if vertical scrollbar should be displayed
            if (this.view.scrollHeight > this.view.clientHeight) {
                displayY = true;
                paddingRight = this.overlay ? '0' : this._nativeScrollbarSize;
            }
        }
        if (this.trackX) {
            // Check if horizontal scrollbar should be displayed
            if (this.view.scrollWidth > this.view.clientWidth) {
                displayX = true;
                paddingBottom = this.overlay ? '0' : this._nativeScrollbarSize;
            }
        }
        this._state.next({
            viewStyle: {
                width: size,
                height: size,
                paddingBottom: paddingBottom,
                paddingRight: paddingRight
            },
            displayX: displayX,
            displayY: displayY
        });
    };
    /**
     * @return {?}
     */
    NgScrollbar.prototype.resetState = /**
     * @return {?}
     */
    function () {
        this._state.next({
            viewStyle: tslib_1.__assign({}, this._state.value.viewStyle, defaultState.viewStyle),
            displayX: defaultState.displayX,
            displayY: defaultState.displayY
        });
    };
    NgScrollbar.decorators = [
        { type: Component, args: [{
                    selector: 'ng-scrollbar',
                    template: "<div class=\"ng-scrollbar-container\">\r\n\r\n  <div cdkScrollable smoothScroll class=\"ng-scrollbar-view {{viewClass}}\" [ngStyle]=\"viewStyle | async\">\r\n    <ng-content></ng-content>\r\n  </div>\r\n\r\n  <ng-scrollbar-thumb #vertical\r\n                      *ngIf=\"!disabled && trackY\"\r\n                      orientation=\"vertical\"\r\n                      [class.ng-scrollbar-visible]=\"displayY | async\"\r\n                      [barClass]=\"barClass\"\r\n                      [thumbClass]=\"thumbClass\"\r\n                      [scrollToDuration]=\"scrollToDuration\">\r\n  </ng-scrollbar-thumb>\r\n\r\n  <ng-scrollbar-thumb #horizontal\r\n                      *ngIf=\"!disabled && trackX\"\r\n                      orientation=\"horizontal\"\r\n                      [class.ng-scrollbar-visible]=\"displayX | async\"\r\n                      [barClass]=\"barClass\"\r\n                      [thumbClass]=\"thumbClass\"\r\n                      [scrollToDuration]=\"scrollToDuration\">\r\n  </ng-scrollbar-thumb>\r\n\r\n</div>\r\n",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [":host{display:block;overflow:hidden}.ng-scrollbar-container,.ng-scrollbar-view,:host{position:relative;height:100%;width:100%}.ng-scrollbar-container{overflow:hidden;top:0;left:0}.ng-scrollbar-view{overflow:scroll;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-overflow-scrolling:touch}.ng-scrollbar-view ::-webkit-scrollbar{background:0 0}ng-scrollbar-thumb{display:none}ng-scrollbar-thumb.ng-scrollbar-visible{display:block}::ng-deep .ng-scrollbar-auto-hide .ng-scrollbar{opacity:0;transition:opacity 120ms ease-out}::ng-deep .ng-scrollbar-auto-hide:active .ng-scrollbar,::ng-deep .ng-scrollbar-auto-hide:focus .ng-scrollbar,::ng-deep .ng-scrollbar-auto-hide:hover .ng-scrollbar{opacity:1;transition:opacity 340ms ease-out}::ng-deep .ng-scrollbar{position:absolute;z-index:1;border-radius:4px}::ng-deep .ng-scrollbar-thumb{position:relative;width:0;height:0;border-radius:inherit;background-color:rgba(0,0,0,.2);-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);transition:height 150ms ease-out}::ng-deep .ng-scrollbar-thumb:active,::ng-deep .ng-scrollbar-thumb:hover{background-color:rgba(0,0,0,.3)}::ng-deep .ng-scrollbar-vertical{right:6px;top:6px;bottom:6px;width:8px}::ng-deep .ng-scrollbar-vertical .ng-scrollbar-thumb{width:100%}::ng-deep .ng-scrollbar-horizontal{left:6px;right:6px;bottom:6px;height:8px}::ng-deep .ng-scrollbar-horizontal .ng-scrollbar-thumb{height:100%}"]
                }] }
    ];
    /** @nocollapse */
    NgScrollbar.ctorParameters = function () { return [
        { type: BreakpointObserver }
    ]; };
    NgScrollbar.propDecorators = {
        trackX: [{ type: Input }],
        trackY: [{ type: Input }],
        autoHide: [{ type: Input }],
        autoUpdate: [{ type: Input }],
        viewClass: [{ type: Input }],
        barClass: [{ type: Input }],
        thumbClass: [{ type: Input }],
        scrollToDuration: [{ type: Input }],
        overlay: [{ type: Input }],
        disableOnBreakpoints: [{ type: Input }],
        disableScrollbars: [{ type: Input, args: ['disabled',] }],
        scrollable: [{ type: ViewChild, args: [CdkScrollable,] }],
        smoothScroll: [{ type: ViewChild, args: [SmoothScroll,] }],
        verticalScrollbar: [{ type: ViewChild, args: ['vertical', { read: ElementRef },] }],
        horizontalScrollbar: [{ type: ViewChild, args: ['horizontal', { read: ElementRef },] }],
        autoHideClass: [{ type: HostBinding, args: ['class.ng-scrollbar-auto-hide',] }]
    };
    return NgScrollbar;
}());
export { NgScrollbar };
if (false) {
    /**
     * Horizontal custom scrollbar
     * @type {?}
     */
    NgScrollbar.prototype.trackX;
    /**
     * Vertical custom Scrollbar
     * @type {?}
     */
    NgScrollbar.prototype.trackY;
    /**
     * Auto hide scrollbars on mouse leave
     * @type {?}
     */
    NgScrollbar.prototype.autoHide;
    /**
     * Auto update scrollbars on content changes (Mutation Observer)
     * @type {?}
     */
    NgScrollbar.prototype.autoUpdate;
    /**
     * Viewport class
     * @type {?}
     */
    NgScrollbar.prototype.viewClass;
    /**
     * Scrollbars class
     * @type {?}
     */
    NgScrollbar.prototype.barClass;
    /**
     * Scrollbars thumbnails class
     * @type {?}
     */
    NgScrollbar.prototype.thumbClass;
    /**
     * The smooth scroll duration when a scrollbar is clicked
     * @type {?}
     */
    NgScrollbar.prototype.scrollToDuration;
    /**
     * Use overlay scrollbars
     * @type {?}
     */
    NgScrollbar.prototype.overlay;
    /**
     * Disable custom scrollbars on specific breakpoints
     * @type {?}
     */
    NgScrollbar.prototype.disableOnBreakpoints;
    /** @type {?} */
    NgScrollbar.prototype.disabled;
    /** @type {?} */
    NgScrollbar.prototype.scrollable;
    /** @type {?} */
    NgScrollbar.prototype.smoothScroll;
    /** @type {?} */
    NgScrollbar.prototype.verticalScrollbar;
    /** @type {?} */
    NgScrollbar.prototype.horizontalScrollbar;
    /**
     * Native scrollbar size
     * @type {?}
     */
    NgScrollbar.prototype._nativeScrollbarSize;
    /**
     * Scrollbar state
     * @type {?}
     */
    NgScrollbar.prototype._state;
    /** @type {?} */
    NgScrollbar.prototype.viewStyle;
    /** @type {?} */
    NgScrollbar.prototype.displayX;
    /** @type {?} */
    NgScrollbar.prototype.displayY;
    /**
     * Mutation observer subscription
     * @type {?}
     */
    NgScrollbar.prototype._updateObserverSub$;
    /**
     * CDK breakpoint subscription
     * @type {?}
     */
    NgScrollbar.prototype._breakpointSub$;
    /**
     * Viewport Element
     * @type {?}
     */
    NgScrollbar.prototype.view;
    /**
     * Observe content changes
     * @type {?}
     */
    NgScrollbar.prototype._observer;
    /**
     * Steam that emits when scrollbar thumbnail needs to update (for internal uses)
     * @type {?}
     */
    NgScrollbar.prototype._updateObserver;
    /** @type {?} */
    NgScrollbar.prototype.updateObserver;
    /** @type {?} */
    NgScrollbar.prototype.breakpointObserver;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjcm9sbGJhci8iLCJzb3VyY2VzIjpbInNjcm9sbGJhci9uZy1zY3JvbGxiYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUE0QixVQUFVLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEksT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxXQUFXLEVBQW1CLE1BQU0scUJBQXFCLENBQUM7QUFDdkYsT0FBTyxFQUFjLE9BQU8sRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFvQixNQUFNLE1BQU0sQ0FBQztBQUM1RixPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsWUFBWSxFQUF3QixNQUFNLGdDQUFnQyxDQUFDOzs7Ozs7Ozs7Ozs7QUFhcEYsSUFBTSxZQUFZLEdBQXFCO0lBQ3JDLFNBQVMsRUFBRTtRQUNULFlBQVksRUFBRSxHQUFHO1FBQ2pCLGFBQWEsRUFBRSxHQUFHO0tBQ25CO0lBQ0QsUUFBUSxFQUFFLEtBQUs7SUFDZixRQUFRLEVBQUUsS0FBSztDQUNoQixDQUFDOztJQXdFQSxxQkFBb0Isa0JBQXNDO1FBQXRDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7Ozs7UUE3RDFELGNBQWtCLEtBQUssQ0FBQzs7OztRQUV4QixjQUFrQixJQUFJLENBQUM7Ozs7UUFFdkIsZ0JBQW9CLEtBQUssQ0FBQzs7OztRQUUxQixrQkFBc0IsSUFBSSxDQUFDOzs7O1FBUTNCLHdCQUE0QixHQUFHLENBQUM7Ozs7UUFJaEMsNEJBQWdDO1lBQzlCLFdBQVcsQ0FBQyxnQkFBZ0I7WUFDNUIsV0FBVyxDQUFDLGVBQWU7U0FDNUIsQ0FB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Y0FBYztvQkFDeEIscWlDQUFnQztvQkFFaEMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O2lCQUNoRDs7OztnQkE5QlEsa0JBQWtCOzs7eUJBa0N4QixLQUFLO3lCQUVMLEtBQUs7MkJBRUwsS0FBSzs2QkFFTCxLQUFLOzRCQUVMLEtBQUs7MkJBRUwsS0FBSzs2QkFFTCxLQUFLO21DQUVMLEtBQUs7MEJBRUwsS0FBSzt1Q0FFTCxLQUFLO29DQU1MLEtBQUssU0FBQyxVQUFVOzZCQU1oQixTQUFTLFNBQUMsYUFBYTsrQkFDdkIsU0FBUyxTQUFDLFlBQVk7b0NBQ3RCLFNBQVMsU0FBQyxVQUFVLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFDO3NDQUN4QyxTQUFTLFNBQUMsWUFBWSxFQUFFLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBQztnQ0FFMUMsV0FBVyxTQUFDLDhCQUE4Qjs7c0JBdkU3Qzs7U0FpQ2EsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEhvc3RCaW5kaW5nLCBWaWV3Q2hpbGQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ2RrU2Nyb2xsYWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zY3JvbGxpbmcnO1xyXG5pbXBvcnQgeyBCcmVha3BvaW50T2JzZXJ2ZXIsIEJyZWFrcG9pbnRzLCBCcmVha3BvaW50U3RhdGUgfSBmcm9tICdAYW5ndWxhci9jZGsvbGF5b3V0JztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0LCBTdWJzY3JpcHRpb24sIFN1YnNjcmlwdGlvbkxpa2UgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCB0YXAsIHRocm90dGxlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgU21vb3RoU2Nyb2xsLCBTbW9vdGhTY3JvbGxFYXNlRnVuYyB9IGZyb20gJy4uL3Ntb290aC1zY3JvbGwvc21vb3RoLXNjcm9sbCc7XHJcblxyXG5pbnRlcmZhY2UgTmdTY3JvbGxiYXJTdGF0ZSB7XHJcbiAgdmlld1N0eWxlPzoge1xyXG4gICAgd2lkdGg/OiBzdHJpbmc7XHJcbiAgICBoZWlnaHQ/OiBzdHJpbmc7XHJcbiAgICBwYWRkaW5nUmlnaHQ/OiBzdHJpbmc7XHJcbiAgICBwYWRkaW5nQm90dG9tPzogc3RyaW5nO1xyXG4gIH07XHJcbiAgZGlzcGxheVg/OiBib29sZWFuO1xyXG4gIGRpc3BsYXlZPzogYm9vbGVhbjtcclxufVxyXG5cclxuY29uc3QgZGVmYXVsdFN0YXRlOiBOZ1Njcm9sbGJhclN0YXRlID0ge1xyXG4gIHZpZXdTdHlsZToge1xyXG4gICAgcGFkZGluZ1JpZ2h0OiAnMCcsXHJcbiAgICBwYWRkaW5nQm90dG9tOiAnMCcsXHJcbiAgfSxcclxuICBkaXNwbGF5WDogZmFsc2UsXHJcbiAgZGlzcGxheVk6IGZhbHNlXHJcbn07XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ25nLXNjcm9sbGJhcicsXHJcbiAgdGVtcGxhdGVVcmw6ICduZy1zY3JvbGxiYXIuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJ25nLXNjcm9sbGJhci5zY3NzJ10sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIE5nU2Nyb2xsYmFyIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgLyoqIEhvcml6b250YWwgY3VzdG9tIHNjcm9sbGJhciAqL1xyXG4gIEBJbnB1dCgpIHRyYWNrWCA9IGZhbHNlO1xyXG4gIC8qKiBWZXJ0aWNhbCBjdXN0b20gU2Nyb2xsYmFyICovXHJcbiAgQElucHV0KCkgdHJhY2tZID0gdHJ1ZTtcclxuICAvKiogQXV0byBoaWRlIHNjcm9sbGJhcnMgb24gbW91c2UgbGVhdmUgKi9cclxuICBASW5wdXQoKSBhdXRvSGlkZSA9IGZhbHNlO1xyXG4gIC8qKiBBdXRvIHVwZGF0ZSBzY3JvbGxiYXJzIG9uIGNvbnRlbnQgY2hhbmdlcyAoTXV0YXRpb24gT2JzZXJ2ZXIpICovXHJcbiAgQElucHV0KCkgYXV0b1VwZGF0ZSA9IHRydWU7XHJcbiAgLyoqIFZpZXdwb3J0IGNsYXNzICovXHJcbiAgQElucHV0KCkgdmlld0NsYXNzOiBzdHJpbmc7XHJcbiAgLyoqIFNjcm9sbGJhcnMgY2xhc3MgKi9cclxuICBASW5wdXQoKSBiYXJDbGFzczogc3RyaW5nO1xyXG4gIC8qKiBTY3JvbGxiYXJzIHRodW1ibmFpbHMgY2xhc3MgKi9cclxuICBASW5wdXQoKSB0aHVtYkNsYXNzOiBzdHJpbmc7XHJcbiAgLyoqIFRoZSBzbW9vdGggc2Nyb2xsIGR1cmF0aW9uIHdoZW4gYSBzY3JvbGxiYXIgaXMgY2xpY2tlZCAqL1xyXG4gIEBJbnB1dCgpIHNjcm9sbFRvRHVyYXRpb24gPSA0MDA7XHJcbiAgLyoqIFVzZSBvdmVybGF5IHNjcm9sbGJhcnMgKi9cclxuICBASW5wdXQoKSBvdmVybGF5OiBib29sZWFuO1xyXG4gIC8qKiBEaXNhYmxlIGN1c3RvbSBzY3JvbGxiYXJzIG9uIHNwZWNpZmljIGJyZWFrcG9pbnRzICovXHJcbiAgQElucHV0KCkgZGlzYWJsZU9uQnJlYWtwb2ludHMgPSBbXHJcbiAgICBCcmVha3BvaW50cy5IYW5kc2V0TGFuZHNjYXBlLFxyXG4gICAgQnJlYWtwb2ludHMuSGFuZHNldFBvcnRyYWl0XHJcbiAgXTtcclxuXHJcbiAgLyoqIERpc2FibGUgY3VzdG9tIHNjcm9sbGJhcnMgYW5kIHN3aXRjaCBiYWNrIHRvIG5hdGl2ZSBzY3JvbGxiYXJzICovXHJcbiAgQElucHV0KCdkaXNhYmxlZCcpIHNldCBkaXNhYmxlU2Nyb2xsYmFycyhkaXNhYmxlOiBib29sZWFuKSB7XHJcbiAgICBkaXNhYmxlID8gdGhpcy5kaXNhYmxlKCkgOiB0aGlzLmVuYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgZGlzYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgQFZpZXdDaGlsZChDZGtTY3JvbGxhYmxlKSBzY3JvbGxhYmxlOiBDZGtTY3JvbGxhYmxlO1xyXG4gIEBWaWV3Q2hpbGQoU21vb3RoU2Nyb2xsKSBzbW9vdGhTY3JvbGw6IFNtb290aFNjcm9sbDtcclxuICBAVmlld0NoaWxkKCd2ZXJ0aWNhbCcsIHtyZWFkOiBFbGVtZW50UmVmfSkgdmVydGljYWxTY3JvbGxiYXI6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZCgnaG9yaXpvbnRhbCcsIHtyZWFkOiBFbGVtZW50UmVmfSkgaG9yaXpvbnRhbFNjcm9sbGJhcjogRWxlbWVudFJlZjtcclxuXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5uZy1zY3JvbGxiYXItYXV0by1oaWRlJykgZ2V0IGF1dG9IaWRlQ2xhc3MoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hdXRvSGlkZTtcclxuICB9XHJcblxyXG4gIC8qKiBOYXRpdmUgc2Nyb2xsYmFyIHNpemUgKi9cclxuICBwcml2YXRlIF9uYXRpdmVTY3JvbGxiYXJTaXplOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBTY3JvbGxiYXIgc3RhdGUgKi9cclxuICBwcml2YXRlIF9zdGF0ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8TmdTY3JvbGxiYXJTdGF0ZT4oZGVmYXVsdFN0YXRlKTtcclxuICB2aWV3U3R5bGU6IE9ic2VydmFibGU8YW55PiA9IHRoaXMuX3N0YXRlLnBpcGUobWFwKChzdGF0ZTogTmdTY3JvbGxiYXJTdGF0ZSkgPT4gc3RhdGUudmlld1N0eWxlKSk7XHJcbiAgZGlzcGxheVg6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzLl9zdGF0ZS5waXBlKG1hcCgoc3RhdGU6IE5nU2Nyb2xsYmFyU3RhdGUpID0+IHN0YXRlLmRpc3BsYXlYKSk7XHJcbiAgZGlzcGxheVk6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzLl9zdGF0ZS5waXBlKG1hcCgoc3RhdGU6IE5nU2Nyb2xsYmFyU3RhdGUpID0+IHN0YXRlLmRpc3BsYXlZKSk7XHJcblxyXG4gIC8qKiBNdXRhdGlvbiBvYnNlcnZlciBzdWJzY3JpcHRpb24gKi9cclxuICBwcml2YXRlIF91cGRhdGVPYnNlcnZlclN1YiQ6IFN1YnNjcmlwdGlvbkxpa2UgPSBTdWJzY3JpcHRpb24uRU1QVFk7XHJcbiAgLyoqIENESyBicmVha3BvaW50IHN1YnNjcmlwdGlvbiAqL1xyXG4gIHByaXZhdGUgX2JyZWFrcG9pbnRTdWIkOiBTdWJzY3JpcHRpb25MaWtlID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xyXG4gIC8qKiBWaWV3cG9ydCBFbGVtZW50ICovXHJcbiAgdmlldzogSFRNTEVsZW1lbnQ7XHJcbiAgLyoqIE9ic2VydmUgY29udGVudCBjaGFuZ2VzICovXHJcbiAgcHJpdmF0ZSBfb2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXI7XHJcblxyXG4gIC8qKiBTdGVhbSB0aGF0IGVtaXRzIHdoZW4gc2Nyb2xsYmFyIHRodW1ibmFpbCBuZWVkcyB0byB1cGRhdGUgKGZvciBpbnRlcm5hbCB1c2VzKSAqL1xyXG4gIHByaXZhdGUgX3VwZGF0ZU9ic2VydmVyID0gbmV3IFN1YmplY3QoKTtcclxuICB1cGRhdGVPYnNlcnZlciA9IHRoaXMuX3VwZGF0ZU9ic2VydmVyLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJyZWFrcG9pbnRPYnNlcnZlcjogQnJlYWtwb2ludE9ic2VydmVyKSB7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICB0aGlzLnZpZXcgPSB0aGlzLnNjcm9sbGFibGUuZ2V0RWxlbWVudFJlZigpLm5hdGl2ZUVsZW1lbnQ7XHJcblxyXG4gICAgaWYgKHRoaXMuZGlzYWJsZU9uQnJlYWtwb2ludHMpIHtcclxuICAgICAgLy8gRW5hYmxlL0Rpc2FibGUgY3VzdG9tIHNjcm9sbGJhciBvbiBicmVha3BvaW50cyAoVXNlZCB0byBkaXNhYmxlIHNjcm9sbGJhcnMgb24gbW9iaWxlIHBob25lcylcclxuICAgICAgdGhpcy5fYnJlYWtwb2ludFN1YiQgPSB0aGlzLmJyZWFrcG9pbnRPYnNlcnZlci5vYnNlcnZlKHRoaXMuZGlzYWJsZU9uQnJlYWtwb2ludHMpLnBpcGUoXHJcbiAgICAgICAgLy8gZmlsdGVyKCgpID0+IHRoaXMudmlld0luaXRpYWxpemVkKSxcclxuICAgICAgICB0YXAoKHJlc3VsdDogQnJlYWtwb2ludFN0YXRlKSA9PiByZXN1bHQubWF0Y2hlcyA/IHRoaXMuZGlzYWJsZSgpIDogdGhpcy5lbmFibGUoKSlcclxuICAgICAgKS5zdWJzY3JpYmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZW5hYmxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBkYXRlIHN0YXRlIG9uIGNvbnRlbnQgY2hhbmdlc1xyXG4gICAgdGhpcy5fdXBkYXRlT2JzZXJ2ZXJTdWIkID0gdGhpcy51cGRhdGVPYnNlcnZlci5waXBlKFxyXG4gICAgICB0aHJvdHRsZVRpbWUoMjAwKSxcclxuICAgICAgdGFwKCgpID0+IHRoaXMudXBkYXRlU3RhdGUoKSlcclxuICAgICkuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuX2JyZWFrcG9pbnRTdWIkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB0aGlzLl91cGRhdGVPYnNlcnZlclN1YiQudW5zdWJzY3JpYmUoKTtcclxuICAgIGlmICh0aGlzLl9vYnNlcnZlcikge1xyXG4gICAgICB0aGlzLl9vYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgc2Nyb2xsYmFyIHRodW1ibmFpbCBwb3NpdGlvblxyXG4gICAqL1xyXG4gIHVwZGF0ZSgpIHtcclxuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLl91cGRhdGVPYnNlcnZlci5uZXh0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFbmFibGUgY3VzdG9tIHNjcm9sbGJhclxyXG4gICAqL1xyXG4gIGVuYWJsZSgpIHtcclxuICAgIGlmICh0aGlzLnZpZXcpIHtcclxuICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAvLyBIaWRlIG5hdGl2ZSBzY3JvbGxiYXJzXHJcbiAgICAgIHRoaXMuX25hdGl2ZVNjcm9sbGJhclNpemUgPSBgJHt0aGlzLnZpZXcub2Zmc2V0V2lkdGggLSB0aGlzLnZpZXcuY2xpZW50V2lkdGggKyAxfXB4YDtcclxuICAgICAgdGhpcy51cGRhdGVTdGF0ZSgpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuYXV0b1VwZGF0ZSkge1xyXG4gICAgICAgIC8vIE9ic2VydmUgY29udGVudCBjaGFuZ2VzXHJcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB0aGlzLnVwZGF0ZSgpKTtcclxuICAgICAgICB0aGlzLl9vYnNlcnZlci5vYnNlcnZlKHRoaXMudmlldywge3N1YnRyZWU6IHRydWUsIGNoaWxkTGlzdDogdHJ1ZSwgY2hhcmFjdGVyRGF0YTogdHJ1ZX0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEaXNhYmxlIGN1c3RvbSBzY3JvbGxiYXJcclxuICAgKi9cclxuICBkaXNhYmxlKCkge1xyXG4gICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAvLyBTaG93IE5hdGl2ZSBTY3JvbGxiYXJzXHJcbiAgICB0aGlzLnJlc2V0U3RhdGUoKTtcclxuICAgIGlmICh0aGlzLl9vYnNlcnZlcikge1xyXG4gICAgICB0aGlzLl9vYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzY3JvbGxUbyhvcHRpb25zOiBTY3JvbGxUb09wdGlvbnMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxUbyhvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHNjcm9sbFRvRWxlbWVudChzZWxlY3Rvcjogc3RyaW5nLCBvZmZzZXQgPSAwLCBkdXJhdGlvbj86IG51bWJlciwgZWFzZUZ1bmM/OiBTbW9vdGhTY3JvbGxFYXNlRnVuYyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvRWxlbWVudChzZWxlY3Rvciwgb2Zmc2V0LCBkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsWFRvKHRvOiBudW1iZXIsIGR1cmF0aW9uPzogbnVtYmVyLCBlYXNlRnVuYz86IFNtb290aFNjcm9sbEVhc2VGdW5jKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsWFRvKHRvLCBkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsWVRvKHRvOiBudW1iZXIsIGR1cmF0aW9uPzogbnVtYmVyLCBlYXNlRnVuYz86IFNtb290aFNjcm9sbEVhc2VGdW5jKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsWVRvKHRvLCBkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsVG9Ub3AoZHVyYXRpb24/OiBudW1iZXIsIGVhc2VGdW5jPzogU21vb3RoU2Nyb2xsRWFzZUZ1bmMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxUb1RvcChkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsVG9Cb3R0b20oZHVyYXRpb24/OiBudW1iZXIsIGVhc2VGdW5jPzogU21vb3RoU2Nyb2xsRWFzZUZ1bmMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxUb0JvdHRvbShkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgc2Nyb2xsVG9SaWdodChkdXJhdGlvbj86IG51bWJlciwgZWFzZUZ1bmM/OiBTbW9vdGhTY3JvbGxFYXNlRnVuYyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvUmlnaHQoZHVyYXRpb24sIGVhc2VGdW5jKTtcclxuICB9XHJcblxyXG4gIHNjcm9sbFRvTGVmdChkdXJhdGlvbj86IG51bWJlciwgZWFzZUZ1bmM/OiBTbW9vdGhTY3JvbGxFYXNlRnVuYyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvTGVmdChkdXJhdGlvbiwgZWFzZUZ1bmMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVTdGF0ZSgpIHtcclxuICAgIGxldCBwYWRkaW5nQm90dG9tID0gJzAnLCBwYWRkaW5nUmlnaHQgPSAnMCcsIGRpc3BsYXlZID0gZmFsc2UsIGRpc3BsYXlYID0gZmFsc2U7XHJcbiAgICBjb25zdCBzaXplID0gYGNhbGMoMTAwJSArICR7dGhpcy5fbmF0aXZlU2Nyb2xsYmFyU2l6ZX0pYDtcclxuICAgIGlmICh0aGlzLnRyYWNrWSkge1xyXG4gICAgICAvLyBDaGVjayBpZiB2ZXJ0aWNhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgICBpZiAodGhpcy52aWV3LnNjcm9sbEhlaWdodCA+IHRoaXMudmlldy5jbGllbnRIZWlnaHQpIHtcclxuICAgICAgICBkaXNwbGF5WSA9IHRydWU7XHJcbiAgICAgICAgcGFkZGluZ1JpZ2h0ID0gdGhpcy5vdmVybGF5ID8gJzAnIDogdGhpcy5fbmF0aXZlU2Nyb2xsYmFyU2l6ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudHJhY2tYKSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIGhvcml6b250YWwgc2Nyb2xsYmFyIHNob3VsZCBiZSBkaXNwbGF5ZWRcclxuICAgICAgaWYgKHRoaXMudmlldy5zY3JvbGxXaWR0aCA+IHRoaXMudmlldy5jbGllbnRXaWR0aCkge1xyXG4gICAgICAgIGRpc3BsYXlYID0gdHJ1ZTtcclxuICAgICAgICBwYWRkaW5nQm90dG9tID0gdGhpcy5vdmVybGF5ID8gJzAnIDogdGhpcy5fbmF0aXZlU2Nyb2xsYmFyU2l6ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5fc3RhdGUubmV4dCh7XHJcbiAgICAgIHZpZXdTdHlsZToge1xyXG4gICAgICAgIHdpZHRoOiBzaXplLFxyXG4gICAgICAgIGhlaWdodDogc2l6ZSxcclxuICAgICAgICBwYWRkaW5nQm90dG9tLFxyXG4gICAgICAgIHBhZGRpbmdSaWdodFxyXG4gICAgICB9LFxyXG4gICAgICBkaXNwbGF5WCxcclxuICAgICAgZGlzcGxheVlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZXNldFN0YXRlKCkge1xyXG4gICAgdGhpcy5fc3RhdGUubmV4dCh7XHJcbiAgICAgIHZpZXdTdHlsZToge1xyXG4gICAgICAgIC4uLnRoaXMuX3N0YXRlLnZhbHVlLnZpZXdTdHlsZSxcclxuICAgICAgICAuLi5kZWZhdWx0U3RhdGUudmlld1N0eWxlXHJcbiAgICAgIH0sXHJcbiAgICAgIGRpc3BsYXlYOiBkZWZhdWx0U3RhdGUuZGlzcGxheVgsXHJcbiAgICAgIGRpc3BsYXlZOiBkZWZhdWx0U3RhdGUuZGlzcGxheVlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuIl19