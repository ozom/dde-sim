/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Inject, Input, ViewChild, NgZone, ElementRef, ChangeDetectionStrategy, forwardRef } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { fromEvent, BehaviorSubject, Subscription, animationFrameScheduler } from 'rxjs';
import { debounceTime, throttleTime, mergeMap, pluck, takeUntil, tap } from 'rxjs/operators';
import { NgScrollbar } from './ng-scrollbar';
/**
 * @record
 */
function AxisProperties() { }
/** @type {?} */
AxisProperties.prototype.offsetYOrX;
/** @type {?} */
AxisProperties.prototype.scrollTopLeft;
/** @type {?} */
AxisProperties.prototype.clientYOrX;
/** @type {?} */
AxisProperties.prototype.topOrLeft;
/** @type {?} */
AxisProperties.prototype.clientHeightOrWidth;
/** @type {?} */
AxisProperties.prototype.scrollHeightOrWidth;
/** @type {?} */
AxisProperties.prototype.heightOrWidth;
/** @type {?} */
AxisProperties.prototype.transform;
/**
 * @record
 */
function Axis() { }
/** @type {?} */
Axis.prototype.vertical;
/** @type {?} */
Axis.prototype.horizontal;
var ɵ0 = function (val) { return "translate3d(0, " + val + "px, 0)"; }, ɵ1 = function (val) { return "translate3d(" + val + "px, 0, 0)"; };
/** @type {?} */
var axis = {
    vertical: {
        topOrLeft: 'top',
        offsetYOrX: 'offsetY',
        clientYOrX: 'clientY',
        heightOrWidth: 'height',
        scrollTopLeft: 'scrollTop',
        clientHeightOrWidth: 'clientHeight',
        scrollHeightOrWidth: 'scrollHeight',
        transform: ɵ0
    },
    horizontal: {
        topOrLeft: 'left',
        offsetYOrX: 'offsetX',
        clientYOrX: 'clientX',
        heightOrWidth: 'width',
        scrollTopLeft: 'scrollLeft',
        clientHeightOrWidth: 'clientWidth',
        scrollHeightOrWidth: 'scrollWidth',
        transform: ɵ1
    }
};
var NgScrollbarThumb = /** @class */ (function () {
    function NgScrollbarThumb(zone, document, ngScrollbar) {
        this.zone = zone;
        this.document = document;
        this.ngScrollbar = ngScrollbar;
        this._minThumbSize = 20;
        this._naturalThumbSize = 0;
        this._thumbSize = 0;
        this._trackMax = 0;
        this._scrollMax = 0;
        this._currPos = 0;
        this._scroll$ = Subscription.EMPTY;
        this._thumbDrag$ = Subscription.EMPTY;
        this._updateObserver$ = Subscription.EMPTY;
        this._state = new BehaviorSubject({
            transform: 'translate3d(0, 0, 0)'
        });
        /**
         * Scrollbar styles
         */
        this.scrollbarStyle = this._state.asObservable();
    }
    Object.defineProperty(NgScrollbarThumb.prototype, "axis", {
        /**
         * Get the proper properties for scrollbar orientation
         */
        get: /**
         * Get the proper properties for scrollbar orientation
         * @return {?}
         */
        function () {
            return axis[this.orientation];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgScrollbarThumb.prototype, "thumbSize", {
        /**
         * Calculate scrollbar thumbnail size
         */
        get: /**
         * Calculate scrollbar thumbnail size
         * @return {?}
         */
        function () {
            /** @type {?} */
            var scrollBarClientHeightOrWidth = this.bar.nativeElement[this.axis.clientHeightOrWidth];
            /** @type {?} */
            var viewClientHeightOrWidth = this._view[this.axis.clientHeightOrWidth];
            /** @type {?} */
            var viewScrollHeightOrWidth = this._view[this.axis.scrollHeightOrWidth];
            this._naturalThumbSize = scrollBarClientHeightOrWidth / viewScrollHeightOrWidth * scrollBarClientHeightOrWidth;
            this._scrollMax = viewScrollHeightOrWidth - viewClientHeightOrWidth;
            return this.scrollBoundaries(this._naturalThumbSize, this._scrollMax);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgScrollbarThumb.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._view = this.ngScrollbar.scrollable.getElementRef().nativeElement;
        // Start view scroll event
        this._scroll$ = this.ngScrollbar.scrollable.elementScrolled()
            .subscribe(function () { return _this.updateScrollbar(); });
        // Start scrollbar thumbnail drag events
        this.zone.runOutsideAngular(function () {
            return _this._thumbDrag$ = _this.startThumbEvents().subscribe();
        });
        // Update scrollbar thumbnail size on content changes
        this._updateObserver$ = this.ngScrollbar.updateObserver.pipe(throttleTime(200), tap(function () { return _this.updateScrollbar(); }), 
        // Make sure scrollbar thumbnail position is correct after the new content is rendered
        debounceTime(200), tap(function () { return _this.updateScrollbar(); })).subscribe();
        // Initialize scrollbar
        setTimeout(function () { return _this.updateScrollbar(); }, 200);
    };
    /**
     * @return {?}
     */
    NgScrollbarThumb.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._scroll$.unsubscribe();
        this._thumbDrag$.unsubscribe();
        this._updateObserver$.unsubscribe();
    };
    /**
     * Scrollbar click
     * @param e Mouse event
     */
    /**
     * Scrollbar click
     * @param {?} e Mouse event
     * @return {?}
     */
    NgScrollbarThumb.prototype.onScrollbarClick = /**
     * Scrollbar click
     * @param {?} e Mouse event
     * @return {?}
     */
    function (e) {
        var _a;
        if (e.target === e.currentTarget) {
            /** @type {?} */
            var offsetYOrX = e[this.axis.offsetYOrX] - this._naturalThumbSize * .5;
            /** @type {?} */
            var thumbPositionPercentage = offsetYOrX * 100 / this.bar.nativeElement[this.axis.clientHeightOrWidth];
            /** @type {?} */
            var value = thumbPositionPercentage * this._view[this.axis.scrollHeightOrWidth] / 100;
            this.ngScrollbar.scrollTo(/** @type {?} */ (_a = {}, _a[this.axis.topOrLeft] = value, _a.duration = this.scrollToDuration, _a)).subscribe();
        }
    };
    /**
     * Update scrollbar
     * @return {?}
     */
    NgScrollbarThumb.prototype.updateScrollbar = /**
     * Update scrollbar
     * @return {?}
     */
    function () {
        var _this = this;
        this._thumbSize = this.thumb.nativeElement[this.axis.clientHeightOrWidth];
        this._trackMax = this.bar.nativeElement[this.axis.clientHeightOrWidth] - this._thumbSize;
        this._currPos = this._view[this.axis.scrollTopLeft] * this._trackMax / this._scrollMax;
        this.zone.run(function () {
            return animationFrameScheduler.schedule(function () {
                var _a;
                return _this.updateState((_a = {
                        transform: _this.axis.transform(_this._currPos)
                    },
                    _a[_this.axis.heightOrWidth] = _this.thumbSize + "px",
                    _a));
            });
        });
    };
    /**
     * Start vertical thumb worker
     * @return {?}
     */
    NgScrollbarThumb.prototype.startThumbEvents = /**
     * Start vertical thumb worker
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var mouseDown$ = fromEvent(this.thumb.nativeElement, 'mousedown');
        /** @type {?} */
        var mouseMove$ = fromEvent(this.document, 'mousemove');
        /** @type {?} */
        var mouseUp$ = fromEvent(this.document, 'mouseup').pipe(tap(function () { return _this.document.onselectstart = null; }));
        return mouseDown$.pipe(tap(function () {
            _this.document.onselectstart = function () { return false; };
            // Initialize trackMax for before start dragging
            _this._trackMax = _this.bar.nativeElement[_this.axis.clientHeightOrWidth] - _this._thumbSize;
        }), pluck(this.axis.offsetYOrX), mergeMap(function (mouseDownOffset) { return mouseMove$.pipe(takeUntil(mouseUp$), pluck(_this.axis.clientYOrX), tap(function (mouseMoveClient) {
            var _a;
            /** @type {?} */
            var offsetYOrX = mouseMoveClient - _this.bar.nativeElement.getBoundingClientRect()[_this.axis.topOrLeft];
            /** @type {?} */
            var value = _this._scrollMax * (offsetYOrX - mouseDownOffset) / _this._trackMax;
            _this.ngScrollbar.scrollable.scrollTo((_a = {}, _a[_this.axis.topOrLeft] = value, _a));
        })); }));
    };
    /**
     * Get scrollbar thumb size
     * @param {?} naturalThumbSize
     * @param {?} scrollMax
     * @return {?}
     */
    NgScrollbarThumb.prototype.scrollBoundaries = /**
     * Get scrollbar thumb size
     * @param {?} naturalThumbSize
     * @param {?} scrollMax
     * @return {?}
     */
    function (naturalThumbSize, scrollMax) {
        return (naturalThumbSize < this._minThumbSize) ? this._minThumbSize : scrollMax ? naturalThumbSize : 0;
    };
    /**
     * @param {?} state
     * @return {?}
     */
    NgScrollbarThumb.prototype.updateState = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this._state.next(tslib_1.__assign({}, this._state.value, state));
    };
    NgScrollbarThumb.decorators = [
        { type: Component, args: [{
                    selector: 'ng-scrollbar-thumb',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    template: "\n    <div #bar class=\"ng-scrollbar ng-scrollbar-{{orientation}} {{barClass}}\" (mousedown)=\"onScrollbarClick($event)\">\n      <div #thumb class=\"ng-scrollbar-thumb {{thumbClass}}\" [ngStyle]=\"scrollbarStyle | async\"></div>\n    </div>\n  "
                }] }
    ];
    /** @nocollapse */
    NgScrollbarThumb.ctorParameters = function () { return [
        { type: NgZone },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: NgScrollbar, decorators: [{ type: Inject, args: [forwardRef(function () { return NgScrollbar; }),] }] }
    ]; };
    NgScrollbarThumb.propDecorators = {
        barClass: [{ type: Input }],
        thumbClass: [{ type: Input }],
        scrollToDuration: [{ type: Input }],
        orientation: [{ type: Input }],
        bar: [{ type: ViewChild, args: ['bar',] }],
        thumb: [{ type: ViewChild, args: ['thumb',] }]
    };
    return NgScrollbarThumb;
}());
export { NgScrollbarThumb };
if (false) {
    /**
     * Scrollbar class
     * @type {?}
     */
    NgScrollbarThumb.prototype.barClass;
    /**
     * Scrollbar thumbnail class
     * @type {?}
     */
    NgScrollbarThumb.prototype.thumbClass;
    /**
     * The scroll duration when scrollbar (not the thumbnail) is clicked
     * @type {?}
     */
    NgScrollbarThumb.prototype.scrollToDuration;
    /**
     * Scrollbar orientation
     * @type {?}
     */
    NgScrollbarThumb.prototype.orientation;
    /** @type {?} */
    NgScrollbarThumb.prototype.bar;
    /** @type {?} */
    NgScrollbarThumb.prototype.thumb;
    /** @type {?} */
    NgScrollbarThumb.prototype._minThumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._naturalThumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._thumbSize;
    /** @type {?} */
    NgScrollbarThumb.prototype._trackMax;
    /** @type {?} */
    NgScrollbarThumb.prototype._scrollMax;
    /** @type {?} */
    NgScrollbarThumb.prototype._currPos;
    /** @type {?} */
    NgScrollbarThumb.prototype._scroll$;
    /** @type {?} */
    NgScrollbarThumb.prototype._thumbDrag$;
    /** @type {?} */
    NgScrollbarThumb.prototype._updateObserver$;
    /** @type {?} */
    NgScrollbarThumb.prototype._view;
    /** @type {?} */
    NgScrollbarThumb.prototype._state;
    /**
     * Scrollbar styles
     * @type {?}
     */
    NgScrollbarThumb.prototype.scrollbarStyle;
    /** @type {?} */
    NgScrollbarThumb.prototype.zone;
    /** @type {?} */
    NgScrollbarThumb.prototype.document;
    /** @type {?} */
    NgScrollbarThumb.prototype.ngScrollbar;
}
export { ɵ0, ɵ1 };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLXRodW1iLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNjcm9sbGJhci8iLCJzb3VyY2VzIjpbInNjcm9sbGJhci9uZy1zY3JvbGxiYXItdGh1bWIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFHTixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixVQUFVLEVBQ1YsdUJBQXVCLEVBQ3ZCLFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBYyxlQUFlLEVBQUUsWUFBWSxFQUFvQix1QkFBdUIsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2SCxPQUFPLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3RixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1NBMkI5QixVQUFDLEdBQVcsSUFBSyxPQUFBLG9CQUFrQixHQUFHLFdBQVEsRUFBN0IsQ0FBNkIsT0FVOUMsVUFBQyxHQUFXLElBQUssT0FBQSxpQkFBZSxHQUFHLGNBQVcsRUFBN0IsQ0FBNkI7O0FBbkI3RCxJQUFNLElBQUksR0FBUztJQUNqQixRQUFRLEVBQUU7UUFDUixTQUFTLEVBQUUsS0FBSztRQUNoQixVQUFVLEVBQUUsU0FBUztRQUNyQixVQUFVLEVBQUUsU0FBUztRQUNyQixhQUFhLEVBQUUsUUFBUTtRQUN2QixhQUFhLEVBQUUsV0FBVztRQUMxQixtQkFBbUIsRUFBRSxjQUFjO1FBQ25DLG1CQUFtQixFQUFFLGNBQWM7UUFDbkMsU0FBUyxJQUFnRDtLQUMxRDtJQUNELFVBQVUsRUFBRTtRQUNWLFNBQVMsRUFBRSxN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QyxLQUFVO1FBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxzQkFBSyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBSyxLQUFLLEVBQUUsQ0FBQzs7O2dCQWxLdEQsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxvQkFBb0I7b0JBQzlCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO29CQUMvQyxRQUFRLEVBQUUsdVBBSVQ7aUJBQ0Y7Ozs7Z0JBekRDLE1BQU07Z0RBNkdPLE1BQU0sU0FBQyxRQUFRO2dCQXJHckIsV0FBVyx1QkFzR0wsTUFBTSxTQUFDLFVBQVUsQ0FBQyxjQUFNLE9BQUEsV0FBVyxFQUFYLENBQVcsQ0FBQzs7OzJCQWpEaEQsS0FBSzs2QkFFTCxLQUFLO21DQUVMLEtBQUs7OEJBRUwsS0FBSztzQkFFTCxTQUFTLFNBQUMsS0FBSzt3QkFDZixTQUFTLFNBQUMsT0FBTzs7MkJBN0VwQjs7U0FpRWEsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbmplY3QsXG4gIEFmdGVyVmlld0luaXQsXG4gIE9uRGVzdHJveSxcbiAgSW5wdXQsXG4gIFZpZXdDaGlsZCxcbiAgTmdab25lLFxuICBFbGVtZW50UmVmLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgZm9yd2FyZFJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IGZyb21FdmVudCwgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBTdWJzY3JpcHRpb24sIFN1YnNjcmlwdGlvbkxpa2UsIGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIHRocm90dGxlVGltZSwgbWVyZ2VNYXAsIHBsdWNrLCB0YWtlVW50aWwsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE5nU2Nyb2xsYmFyIH0gZnJvbSAnLi9uZy1zY3JvbGxiYXInO1xuXG5pbnRlcmZhY2UgQXhpc1Byb3BlcnRpZXMge1xuICBvZmZzZXRZT3JYOiBzdHJpbmc7XG4gIHNjcm9sbFRvcExlZnQ6IHN0cmluZztcbiAgY2xpZW50WU9yWDogc3RyaW5nO1xuICB0b3BPckxlZnQ6IHN0cmluZztcbiAgY2xpZW50SGVpZ2h0T3JXaWR0aDogc3RyaW5nO1xuICBzY3JvbGxIZWlnaHRPcldpZHRoOiBzdHJpbmc7XG4gIGhlaWdodE9yV2lkdGg6IHN0cmluZztcbiAgdHJhbnNmb3JtOiAodmFsOiBudW1iZXIpID0+IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEF4aXMge1xuICB2ZXJ0aWNhbDogQXhpc1Byb3BlcnRpZXM7XG4gIGhvcml6b250YWw6IEF4aXNQcm9wZXJ0aWVzO1xufVxuXG5jb25zdCBheGlzOiBBeGlzID0ge1xuICB2ZXJ0aWNhbDoge1xuICAgIHRvcE9yTGVmdDogJ3RvcCcsXG4gICAgb2Zmc2V0WU9yWDogJ29mZnNldFknLFxuICAgIGNsaWVudFlPclg6ICdjbGllbnRZJyxcbiAgICBoZWlnaHRPcldpZHRoOiAnaGVpZ2h0JyxcbiAgICBzY3JvbGxUb3BMZWZ0OiAnc2Nyb2xsVG9wJyxcbiAgICBjbGllbnRIZWlnaHRPcldpZHRoOiAnY2xpZW50SGVpZ2h0JyxcbiAgICBzY3JvbGxIZWlnaHRPcldpZHRoOiAnc2Nyb2xsSGVpZ2h0JyxcbiAgICB0cmFuc2Zvcm06ICh2YWw6IG51bWJlcikgPT4gYHRyYW5zbGF0ZTNkKDAsICR7dmFsfXB4LCAwKWBcbiAgfSxcbiAgaG9yaXpvbnRhbDoge1xuICAgIHRvcE9yTGVmdDogJ2xlZnQnLFxuICAgIG9mZnNldFlPclg6ICdvZmZzZXRYJyxcbiAgICBjbGllbnRZT3JYOiAnY2xpZW50WCcsXG4gICAgaGVpZ2h0T3JXaWR0aDogJ3dpZHRoJyxcbiAgICBzY3JvbGxUb3BMZWZ0OiAnc2Nyb2xsTGVmdCcsXG4gICAgY2xpZW50SGVpZ2h0T3JXaWR0aDogJ2NsaWVudFdpZHRoJyxcbiAgICBzY3JvbGxIZWlnaHRPcldpZHRoOiAnc2Nyb2xsV2lkdGgnLFxuICAgIHRyYW5zZm9ybTogKHZhbDogbnVtYmVyKSA9PiBgdHJhbnNsYXRlM2QoJHt2YWx9cHgsIDAsIDApYFxuICB9XG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZy1zY3JvbGxiYXItdGh1bWInLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2ICNiYXIgY2xhc3M9XCJuZy1zY3JvbGxiYXIgbmctc2Nyb2xsYmFyLXt7b3JpZW50YXRpb259fSB7e2JhckNsYXNzfX1cIiAobW91c2Vkb3duKT1cIm9uU2Nyb2xsYmFyQ2xpY2soJGV2ZW50KVwiPlxuICAgICAgPGRpdiAjdGh1bWIgY2xhc3M9XCJuZy1zY3JvbGxiYXItdGh1bWIge3t0aHVtYkNsYXNzfX1cIiBbbmdTdHlsZV09XCJzY3JvbGxiYXJTdHlsZSB8IGFzeW5jXCI+PC9kaXY+XG4gICAgPC9kaXY+XG4gIGBcbn0pXG5leHBvcnQgY2xhc3MgTmdTY3JvbGxiYXJUaHVtYiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgLyoqIFNjcm9sbGJhciBjbGFzcyAqL1xuICBASW5wdXQoKSBiYXJDbGFzczogc3RyaW5nO1xuICAvKiogU2Nyb2xsYmFyIHRodW1ibmFpbCBjbGFzcyAqL1xuICBASW5wdXQoKSB0aHVtYkNsYXNzOiBzdHJpbmc7XG4gIC8qKiBUaGUgc2Nyb2xsIGR1cmF0aW9uIHdoZW4gc2Nyb2xsYmFyIChub3QgdGhlIHRodW1ibmFpbCkgaXMgY2xpY2tlZCAqL1xuICBASW5wdXQoKSBzY3JvbGxUb0R1cmF0aW9uOiBudW1iZXI7XG4gIC8qKiBTY3JvbGxiYXIgb3JpZW50YXRpb24gKi9cbiAgQElucHV0KCkgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCc7XG5cbiAgQFZpZXdDaGlsZCgnYmFyJykgYmFyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd0aHVtYicpIHRodW1iOiBFbGVtZW50UmVmO1xuXG4gIHByaXZhdGUgX21pblRodW1iU2l6ZSA9IDIwO1xuICBwcml2YXRlIF9uYXR1cmFsVGh1bWJTaXplID0gMDtcbiAgcHJpdmF0ZSBfdGh1bWJTaXplID0gMDtcbiAgcHJpdmF0ZSBfdHJhY2tNYXggPSAwO1xuICBwcml2YXRlIF9zY3JvbGxNYXggPSAwO1xuICBwcml2YXRlIF9jdXJyUG9zID0gMDtcbiAgcHJpdmF0ZSBfc2Nyb2xsJDogU3Vic2NyaXB0aW9uTGlrZSA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBfdGh1bWJEcmFnJDogU3Vic2NyaXB0aW9uTGlrZSA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBfdXBkYXRlT2JzZXJ2ZXIkOiBTdWJzY3JpcHRpb25MaWtlID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuICBwcml2YXRlIF92aWV3OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBfc3RhdGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oe1xuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZTNkKDAsIDAsIDApJ1xuICB9KTtcblxuICAvKiogU2Nyb2xsYmFyIHN0eWxlcyAqL1xuICBzY3JvbGxiYXJTdHlsZSA9IHRoaXMuX3N0YXRlLmFzT2JzZXJ2YWJsZSgpO1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHByb3BlciBwcm9wZXJ0aWVzIGZvciBzY3JvbGxiYXIgb3JpZW50YXRpb25cbiAgICovXG4gIGdldCBheGlzKCk6IEF4aXNQcm9wZXJ0aWVzIHtcbiAgICByZXR1cm4gYXhpc1t0aGlzLm9yaWVudGF0aW9uXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgc2Nyb2xsYmFyIHRodW1ibmFpbCBzaXplXG4gICAqL1xuICBnZXQgdGh1bWJTaXplKCk6IG51bWJlciB7XG4gICAgY29uc3Qgc2Nyb2xsQmFyQ2xpZW50SGVpZ2h0T3JXaWR0aCA9IHRoaXMuYmFyLm5hdGl2ZUVsZW1lbnRbdGhpcy5heGlzLmNsaWVudEhlaWdodE9yV2lkdGhdO1xuICAgIGNvbnN0IHZpZXdDbGllbnRIZWlnaHRPcldpZHRoID0gdGhpcy5fdmlld1t0aGlzLmF4aXMuY2xpZW50SGVpZ2h0T3JXaWR0aF07XG4gICAgY29uc3Qgdmlld1Njcm9sbEhlaWdodE9yV2lkdGggPSB0aGlzLl92aWV3W3RoaXMuYXhpcy5zY3JvbGxIZWlnaHRPcldpZHRoXTtcbiAgICB0aGlzLl9uYXR1cmFsVGh1bWJTaXplID0gc2Nyb2xsQmFyQ2xpZW50SGVpZ2h0T3JXaWR0aCAvIHZpZXdTY3JvbGxIZWlnaHRPcldpZHRoICogc2Nyb2xsQmFyQ2xpZW50SGVpZ2h0T3JXaWR0aDtcbiAgICB0aGlzLl9zY3JvbGxNYXggPSB2aWV3U2Nyb2xsSGVpZ2h0T3JXaWR0aCAtIHZpZXdDbGllbnRIZWlnaHRPcldpZHRoO1xuICAgIHJldHVybiB0aGlzLnNjcm9sbEJvdW5kYXJpZXModGhpcy5fbmF0dXJhbFRodW1iU2l6ZSwgdGhpcy5fc2Nyb2xsTWF4KTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgem9uZTogTmdab25lLFxuICAgICAgICAgICAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBhbnksXG4gICAgICAgICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBOZ1Njcm9sbGJhcikpIHByaXZhdGUgbmdTY3JvbGxiYXI6IE5nU2Nyb2xsYmFyKSB7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5fdmlldyA9IHRoaXMubmdTY3JvbGxiYXIuc2Nyb2xsYWJsZS5nZXRFbGVtZW50UmVmKCkubmF0aXZlRWxlbWVudDtcbiAgICAvLyBTdGFydCB2aWV3IHNjcm9sbCBldmVudFxuICAgIHRoaXMuX3Njcm9sbCQgPSB0aGlzLm5nU2Nyb2xsYmFyLnNjcm9sbGFibGUuZWxlbWVudFNjcm9sbGVkKClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy51cGRhdGVTY3JvbGxiYXIoKSk7XG5cbiAgICAvLyBTdGFydCBzY3JvbGxiYXIgdGh1bWJuYWlsIGRyYWcgZXZlbnRzXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+XG4gICAgICB0aGlzLl90aHVtYkRyYWckID0gdGhpcy5zdGFydFRodW1iRXZlbnRzKCkuc3Vic2NyaWJlKClcbiAgICApO1xuXG4gICAgLy8gVXBkYXRlIHNjcm9sbGJhciB0aHVtYm5haWwgc2l6ZSBvbiBjb250ZW50IGNoYW5nZXNcbiAgICB0aGlzLl91cGRhdGVPYnNlcnZlciQgPSB0aGlzLm5nU2Nyb2xsYmFyLnVwZGF0ZU9ic2VydmVyLnBpcGUoXG4gICAgICB0aHJvdHRsZVRpbWUoMjAwKSxcbiAgICAgIHRhcCgoKSA9PiB0aGlzLnVwZGF0ZVNjcm9sbGJhcigpKSxcbiAgICAgIC8vIE1ha2Ugc3VyZSBzY3JvbGxiYXIgdGh1bWJuYWlsIHBvc2l0aW9uIGlzIGNvcnJlY3QgYWZ0ZXIgdGhlIG5ldyBjb250ZW50IGlzIHJlbmRlcmVkXG4gICAgICBkZWJvdW5jZVRpbWUoMjAwKSxcbiAgICAgIHRhcCgoKSA9PiB0aGlzLnVwZGF0ZVNjcm9sbGJhcigpKSxcbiAgICApLnN1YnNjcmliZSgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBzY3JvbGxiYXJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlU2Nyb2xsYmFyKCksIDIwMCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9zY3JvbGwkLnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5fdGh1bWJEcmFnJC51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuX3VwZGF0ZU9ic2VydmVyJC51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbGJhciBjbGlja1xuICAgKiBAcGFyYW0gZSBNb3VzZSBldmVudFxuICAgKi9cbiAgb25TY3JvbGxiYXJDbGljayhlOiBhbnkpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCkge1xuICAgICAgY29uc3Qgb2Zmc2V0WU9yWCA9IGVbdGhpcy5heGlzLm9mZnNldFlPclhdIC0gdGhpcy5fbmF0dXJhbFRodW1iU2l6ZSAqIC41O1xuICAgICAgY29uc3QgdGh1bWJQb3NpdGlvblBlcmNlbnRhZ2UgPSBvZmZzZXRZT3JYICogMTAwIC8gdGhpcy5iYXIubmF0aXZlRWxlbWVudFt0aGlzLmF4aXMuY2xpZW50SGVpZ2h0T3JXaWR0aF07XG4gICAgICBjb25zdCB2YWx1ZSA9IHRodW1iUG9zaXRpb25QZXJjZW50YWdlICogdGhpcy5fdmlld1t0aGlzLmF4aXMuc2Nyb2xsSGVpZ2h0T3JXaWR0aF0gLyAxMDA7XG4gICAgICB0aGlzLm5nU2Nyb2xsYmFyLnNjcm9sbFRvKHtbdGhpcy5heGlzLnRvcE9yTGVmdF06IHZhbHVlLCBkdXJhdGlvbjogdGhpcy5zY3JvbGxUb0R1cmF0aW9ufSBhcyBhbnkpLnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2Nyb2xsYmFyXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZVNjcm9sbGJhcigpIHtcbiAgICB0aGlzLl90aHVtYlNpemUgPSB0aGlzLnRodW1iLm5hdGl2ZUVsZW1lbnRbdGhpcy5heGlzLmNsaWVudEhlaWdodE9yV2lkdGhdO1xuICAgIHRoaXMuX3RyYWNrTWF4ID0gdGhpcy5iYXIubmF0aXZlRWxlbWVudFt0aGlzLmF4aXMuY2xpZW50SGVpZ2h0T3JXaWR0aF0gLSB0aGlzLl90aHVtYlNpemU7XG4gICAgdGhpcy5fY3VyclBvcyA9IHRoaXMuX3ZpZXdbdGhpcy5heGlzLnNjcm9sbFRvcExlZnRdICogdGhpcy5fdHJhY2tNYXggLyB0aGlzLl9zY3JvbGxNYXg7XG4gICAgdGhpcy56b25lLnJ1bigoKSA9PlxuICAgICAgYW5pbWF0aW9uRnJhbWVTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT5cbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZSh7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0aGlzLmF4aXMudHJhbnNmb3JtKHRoaXMuX2N1cnJQb3MpLFxuICAgICAgICAgIFt0aGlzLmF4aXMuaGVpZ2h0T3JXaWR0aF06IGAke3RoaXMudGh1bWJTaXplfXB4YFxuICAgICAgICB9KVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgdmVydGljYWwgdGh1bWIgd29ya2VyXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0VGh1bWJFdmVudHMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCBtb3VzZURvd24kID0gZnJvbUV2ZW50KHRoaXMudGh1bWIubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicpO1xuICAgIGNvbnN0IG1vdXNlTW92ZSQgPSBmcm9tRXZlbnQodGhpcy5kb2N1bWVudCwgJ21vdXNlbW92ZScpO1xuICAgIGNvbnN0IG1vdXNlVXAkID0gZnJvbUV2ZW50KHRoaXMuZG9jdW1lbnQsICdtb3VzZXVwJykucGlwZShcbiAgICAgIHRhcCgoKSA9PiB0aGlzLmRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBudWxsKVxuICAgICk7XG4gICAgcmV0dXJuIG1vdXNlRG93biQucGlwZShcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlO1xuICAgICAgICAvLyBJbml0aWFsaXplIHRyYWNrTWF4IGZvciBiZWZvcmUgc3RhcnQgZHJhZ2dpbmdcbiAgICAgICAgdGhpcy5fdHJhY2tNYXggPSB0aGlzLmJhci5uYXRpdmVFbGVtZW50W3RoaXMuYXhpcy5jbGllbnRIZWlnaHRPcldpZHRoXSAtIHRoaXMuX3RodW1iU2l6ZTtcbiAgICAgIH0pLFxuICAgICAgcGx1Y2sodGhpcy5heGlzLm9mZnNldFlPclgpLFxuICAgICAgbWVyZ2VNYXAoKG1vdXNlRG93bk9mZnNldDogbnVtYmVyKSA9PiBtb3VzZU1vdmUkLnBpcGUoXG4gICAgICAgIHRha2VVbnRpbChtb3VzZVVwJCksXG4gICAgICAgIHBsdWNrKHRoaXMuYXhpcy5jbGllbnRZT3JYKSxcbiAgICAgICAgdGFwKChtb3VzZU1vdmVDbGllbnQ6IG51bWJlcikgPT4ge1xuICAgICAgICAgIGNvbnN0IG9mZnNldFlPclggPSBtb3VzZU1vdmVDbGllbnQgLSB0aGlzLmJhci5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpW3RoaXMuYXhpcy50b3BPckxlZnRdO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fc2Nyb2xsTWF4ICogKG9mZnNldFlPclggLSBtb3VzZURvd25PZmZzZXQpIC8gdGhpcy5fdHJhY2tNYXg7XG4gICAgICAgICAgdGhpcy5uZ1Njcm9sbGJhci5zY3JvbGxhYmxlLnNjcm9sbFRvKHtbdGhpcy5heGlzLnRvcE9yTGVmdF06IHZhbHVlfSk7XG4gICAgICAgIH0pXG4gICAgICApKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNjcm9sbGJhciB0aHVtYiBzaXplXG4gICAqIEBwYXJhbSBuYXR1cmFsVGh1bWJTaXplXG4gICAqIEBwYXJhbSBzY3JvbGxNYXhcbiAgICovXG4gIHByaXZhdGUgc2Nyb2xsQm91bmRhcmllcyhuYXR1cmFsVGh1bWJTaXplOiBudW1iZXIsIHNjcm9sbE1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gKG5hdHVyYWxUaHVtYlNpemUgPCB0aGlzLl9taW5UaHVtYlNpemUpID8gdGhpcy5fbWluVGh1bWJTaXplIDogc2Nyb2xsTWF4ID8gbmF0dXJhbFRodW1iU2l6ZSA6IDA7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVN0YXRlKHN0YXRlOiBhbnkpIHtcbiAgICB0aGlzLl9zdGF0ZS5uZXh0KHsuLi50aGlzLl9zdGF0ZS52YWx1ZSwgLi4uc3RhdGV9KTtcbiAgfVxufVxuIl19